<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIlury</title>
    <style>
    :root {
      --background-color: #fff;
      --white-color: #fff;
      --grey-color: #ccc;
      --lightgrey-color: #fcfcfc;
      --lightdarkgrey-color: #f4f4f4;
      --black-color: #000;
      --linenumber-color: #999999;
      --drakgrey-color: #f0f0f0;
      --selected-color: #e0f7e9;
      --safariheader-color: #dcdcdc;
      --safariheaderbackground-color: #f7f7f8;
      --urlbarbackground-color: #e6e6e6;
      --urlbarcolor-color: #333;
      --browsercontainerbackground-color: #fff;
      --browserheaderborderbottom-color: #ddd;
      --spencialbtnbackground-color: #ccc;
      --spencialbtncolor-color: #000;
      --overlayborder-color: #999999;
      --overlaycolor-color: #333;
      --rectangleborder: #e0e0e0;
      --overlaybackground-color: rgba(0, 0, 0, 0.5);
      --contentcontainer-color: #fff;
      --checkmark-color: #28a745;
      --seccontainerbackground-color: #fcfcfc;
      --seccontainerlinebackground-color: rgba(200, 200, 200, 0.5);
      --navdotcolor-color: #727272;
      --seccontainerlinecolor-color: #fff;
      --switchcheckedbackground-color: #007aff;
      --filepathinput-color: rgba(0, 0, 0, 0.5);
      --transparentshade-color: rgba(255, 255, 255, 0.2);
      --superselected-color: #28a745;
      --leftarrow-color: #28a745;
      --loadingbarbackground-color: rgba(0, 0, 0, 0.2);
      --loadingbarloadedbackground-color: #007aff;
      --fileloadingoverlaybackground-color: rgba(0, 0, 0, 0.5);
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --background-color: #000;
        --white-color: #000;
          --grey-color: #2E2E2E;
          --lightgrey-color: #0c0c0c;/*fcfcfc*/
          --lightdarkgrey-color: #4f4f4f;/*f4f4f4*/
          --black-color: #fff;
        --linenumber-color: #555555;
        --drakgrey-color: #0f0f0f;
        --selected-color: #0E7F9E;
        --safariheader-color: #0c0c0c;
        --safariheaderbackground-color: #0E0F0E;
        --urlbarbackground-color: #3A3A3A;
        --urlbarcolor-color: #fff;
        --browsercontainerbackground-color: #000;
        --browserheaderborderbottom-color: #121212;
        --spencialbtnbackground-color: #121212;
        --spencialbtncolor-color: #fff;
        --overlayborder-color: #121212;
        --overlaycolor-color: #666;
        --rectangleborder: #363736;/*0e0e0e*/
        --overlaybackground-color: rgba(0, 0, 0, 0.5);
        --contentcontainer-color: #000;/*0c0c0c*/
        --checkmark-color: #0E7F9E;
        --seccontainerbackground-color: #0c0c0c;
        --seccontainerlinebackground-color: rgba(50, 50, 50, 0.5);
        --navdotcolor-color: #999999;
        --seccontainerlinecolor-color: #666;
        --switchcheckedbackground-color: #0156CD;
        --filepathinput-color: rgba(255, 255, 255, 0.5);
        --transparentshade-color: rgba(0, 0, 0, 0.2);
        --superselected-color: #28a745;
        --leftarrow-color: #28a745;
          --loadingbarbackground-color: rgba(0, 0, 0, 0.2);
            --loadingbarloadedbackground-color: #0156CD;
            --fileloadingoverlaybackground-color: rgba(0, 0, 0, 0.5);
      }
    }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            height: 100vh;
            overflow: hidden;
            background-color: var(--background-color);/*#f7f9fc*/
        }

        .container {
            height: 100vh;
            width: 100vw; /* Enough width for 5 sections */
            display: flex;
            scroll-snap-type: x mandatory;
            overflow-x: hidden;
            transition: transform 0.5s ease-in-out;

        }

        .section {
            min-width: 100vw;
            height: 100vh;
            display: flex;
      flex-direction: column;
            /*justify-content: center;
            align-items: center;
            position: relative;
            font-size: 2rem;
            text-align: center;
      color: rgba(0, 0, 0, 0.5);*/
      background: transparent;
    }

  @keyframes swipein {
    0%{
        transform: translateY(-100vh);
      opacity: 0;
    }
    100%{
        transform: translateY(0);
      opacity: 1;
    }
  }
  @keyframes swipeout {
    0%{
        transform: translateY(0);
      opacity: 1;
    }
    100%{
        transform: translateY(150vh);
      opacity: 0;
    }
  }
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100vw;
            display: flex;
            height: 50px;
            background-color: var(--seccontainerbackground-color);/*--lightgrey-color*/
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2);
            border-radius: 10px 10px 0 0;
            overflow-x: auto;
            scroll-behavior: smooth;
            scroll-snap-type: x mandatory;
            transition: height 0.4s ease, box-shadow 0.4s ease;
        }

        .nav-bar.expanded {
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
        }


        .nav-bar div {
            min-width: 100vw;
            height: 50px;
            background-color: var(--seccontainerbackground-color);/*--lightgrey-color*/
            color: var(--black-color);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s, box-shadow 0.3s ease-in-out;
            scroll-snap-align: center;
            border-radius: 10px 10px 0 0;
            position: relative;
            overflow: hidden;
        }

        .nav-bar div:hover {
            background-color: var(--lightdarkgrey-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .nav-bar .active {
            background-color: var(--lightgrey-color);
        }

        .expanded {
            height: 100vh;
        }

        .nav-dot-content {
            display: none;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            width: 100%;
            text-align: center;
            color: var(--black-color);
            position: relative;
            box-shadow: 0 -10px 20px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            animation: fadeInUp 0.5s ease-in-out;
        }

        .expanded .nav-dot-content {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .input-field {
            margin-top: 20px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            width: 80%;
            font-size: 1rem;
            transition: box-shadow 0.3s ease;
        }

        .input-field:focus {
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            outline: none;
        }

    .seccontainer {
            width: 100vw;
            height: 85vh;
            background-color: var(--seccontainerbackground-color);
            color: var(--black-color);
            transition: background-color 0.3s, box-shadow 0.3s ease-in-out;
            scroll-snap-align: center;
            border-radius: 10px 10px 0 0;
            position: fixed;
            overflow: hidden;
      bottom: 0;
      left: 0;
      animation: up 1s;
      padding: 10px;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      overflow-y: scroll;
        }

    .seccontainer-line{
      display: flex;
      justify-content: space-between;
      width: 70vw;
      /*min-width: 500px;*/
      font-size: 1.5em;
      margin-bottom: 2vh;
      border-radius: 10px;
      background: var(--seccontainerlinebackground-color);
      padding: 10px;
      color: var(--seccontainerlinecolor-color);
    }

    @keyframes up{
      0%{ transform: translateY(100vh); }
      100%{ transform: translateY(0); }
    }

    .input-field {
            margin-top: 20px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            width: 80%;
            font-size: 1rem;
            transition: box-shadow 0.3s ease;
        }

        .input-field:focus {
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            outline: none;
        }
    .switch {
        position: relative;
          display: inline-block;
          width: 51px;
          height: 31px;
    }

    .switch input {
          opacity: 0;
          width: 0;
          height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--grey-color);
        border-radius: 34px;
          transition: .4s;
    }

    .slider:before {
          position: absolute;
          content: "";
        height: 23px;
        width: 23px;
        left: 4px;
        bottom: 4px;
        background: var(--white-color);
        border-radius: 50%;
        transition: .4s;
    }

    input:checked + .slider {
        background: var(--switchcheckedbackground-color);/*linear-gradient(90deg, #ff0077, #7700ff);*//*#4cd964*/
    }

    input:checked + .slider:before {
        transform: translateX(20px);
    }







    .code-editor-container {
      position: relative;
            height: 70vh;
            width: 90vw;
            border-radius: 5px;
            background: var(--white-color);
      box-shadow: inset 0px 0px 20px var(--white-color);
          padding: 5px 4.5em;/*4.5em*/
          overflow-y: scroll;
          overflow-x: hidden;
        }
      @media (max-width: 700px) {
            .code-editor-container {
                width: 90vw;
            padding: 5px 3.5em;
            height: 65vh;
            }
        }
      @media (max-width: 600px) {
            .code-editor-container {
                width: 100vw;
            padding: 5px 3em;
            height: 62vh;
            }
        }
        .code-editor-line {
            display: flex;/*inline-block*/
            position: relative;
            border-radius: 5px;
            background: var(--white-color);
            color: var(--black-color);
            font-size: 1em;
            font-family: "Fira Code", "JetBrains Mono", monospace;
            letter-spacing: 0.06em;
            text-align: left;
            padding: 5px;
            transition: 0.5s;
            white-space: pre-wrap;
            /*width: 70vw;*/
            box-sizing: border-box;
            cursor: pointer;
          opacity: 1;
      /*word-break: break-word;*/
        }
        .code-editor-line:focus {
            outline: none;
            background: var(--drakgrey-color);
        }
        .code-editor-line {
            counter-increment: line-number;
            position: relative;
        }
        #linenumberingon .code-editor-line::before {
            content: counter(line-number) ". ";
            position: absolute;
            right: 101%;
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-size: 0.7em;
            border: none;
            color: var(--linenumber-color);
        }
        /* Checkmark style */
        .code-editor-line.selected::after {
            content: '✓';
            position: absolute;
            left: -3.5em;
            top: 0;
            color: var(--checkmark-color);
            font-size: 1.2em;
        }
        /* Selected line styling */
        .code-editor-line.selected.topSelected {
          border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0; /* Falls du die untere rechte Ecke ebenfalls abgerundet haben möchtest */
        }

        .code-editor-line.selected.bottomSelected {
          border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
            border-top-left-radius: 0;
            border-top-right-radius: 0; /* Falls du die obere rechte Ecke ebenfalls abgerundet haben möchtest */
        }

        .code-editor-line.selected.middleSelected {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0; /* Entfernt alle Ecken */
        }

        .code-editor-line.selected.singleSelected {
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px; /* Rundet alle Ecken */
        }
        .code-editor-line.superselected {
            border-radius: 5px;
            background: var(--superselected-color);
            transform: translateX(1.5em); /* Slight movement to the right */
        }
        .code-editor-line.superselected::after {
            content: '→';
            position: absolute;
            left: -3.5em;
            top: 0;
            color: var(--leftarrow-color);
            font-size: 1.2em;
        }

      .editor-selected-line-btns{
          width: 90vw;
          background: var(--white-color);
          height: 8vh;
          padding: 10px;
          display: flex;
          overflow-x: scroll;
          overflow-y: hidden;
      }
      .eslbtn{
          color: var(--black-color);
          width: 6vh;
          height: 6vh;
          min-width: 40px;
          min-height: 40px;
          background: var(--white-color);
          text-align: center;
          border: none;
          border-radius: 50%;
          font-weight: bold;
          font-size: 0.85em;
          margin-left: 1%;
          transition: 0.5s;
      }
      .eslbtn:hover{
          background: var(--drakgrey-color);
      }
      .disabled{
          pointer-events: none;
            opacity: 0.5;
      }
      .disableline{
          pointer-events: none;
            opacity: 0.5;
      }
      .importantpin{
          background: rgba(255, 0, 0, 0.5);/*#F09286*/
      }
      .code-editor-line.selected {
            background: var(--selected-color);
            transform: translateX(1.5em); /* Slight movement to the right */
          border-radius: 0;
        }
      /*.unsleeplines{*/
      .code-editor-btn{
          color: var(--black-color);
          width: 6vh;
          height: 6vh;
          min-width: 40px;
          min-height: 40px;
          background: var(--white-color);
          text-align: center;
          border: none;
          border-radius: 50%;
          font-weight: bold;
          font-size: 0.85em;
          margin-left: 1%;
          transition: 0.5s;

      }
      .unsleeplines:hover{
          background: var(--drakgrey-color);
      }
      .hiddenlinesparent{
          transform: translateX(-1.5em);
      }
      .hidden{
          display: none;
          /*animation: Hide 1s forwards;*/
      }
      @keyframes Hide {
          100%{
            transform: translateY(-50px);
            opacity: 0;
            display: none;
          }
        }
      .code-editor-btns{
          width: 90vw;
          background: var(--white-color);
          height: 8vh;
          padding: 10px;
          display: flex;
          overflow-x: scroll;
          overflow-y: hidden;
      }
    .filePathInput{
      font-size: 1em;
      color: var(--filepathinput-color);
      font-weight: bold;
      background: transparent;
      border: none;
      display: inline-block;
      width: 100%;
      text-align: center;
    }
    .filePathInput:focus{
      outline: none;
    }






        .viewcontainer {
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .swipe-container {
            display: flex;
            width: 100vw;
            height: 100vh;
            scroll-snap-type: x mandatory;
            overflow-x: scroll;
            scroll-behavior: smooth;
        }

        .view {
            width: 100vw;
            height: 90vh;
            flex-shrink: 0;
            scroll-snap-align: start;
      padding: 5vh 0;
        }

        .mobile-container, .browser-container {
            margin: auto;
        }

        .mobile-container {
            max-width: 375px;
      width: calc(100vw - 1em);
            max-height: 667px;
      height: calc(100vh - 1em);
            border-radius: 35px;
            background-color: var(--white-color);
            box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            border: 1em solid #333;
        }

        /* Safari-like top bar */
        .safari-header {
            background-color: var(--safariheaderbackground-color);
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            border-bottom: 1px solid var(--safariheader-color);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
        }

        .safari-header .safari-buttons {
            display: flex;
            gap: 8px;
        }

        .safari-buttons .back-btn {
            width: 12px;
            height: 12px;
            background-color: #007aff;/*333*/
            mask: url('https://upload.wikimedia.org/wikipedia/commons/2/26/Chevron_left_font_awesome.svg') no-repeat center;
            -webkit-mask: url('https://upload.wikimedia.org/wikipedia/commons/2/26/Chevron_left_font_awesome.svg') no-repeat center;
            mask-size: 100%;
            -webkit-mask-size: 100%;
        }

        .url-bar {
            width: 70%;
            height: 28px;
            margin-left: 10px;
            display: flex;
            align-items: center;
            background-color: var(--urlbarbackground-color);
            border-radius: 12px;
            padding: 0 10px;
            font-size: 14px;
            color: #666;
        }

        .url-bar input {
            width: 100%;
            border: none;
            background: transparent;
            outline: none;
            color: var(--urlbarcolor-color);
            font-size: 14px;
        }

        .safari-header .action-btn {
            background-color: #007aff;
            padding: 4px 10px;
            color: white;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
        }

        /* iFrame container */
        .iframe-container {
            flex-grow: 1;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            overflow: hidden;
            background-color: var(--background-color);
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    .browser-container {
            width: 80vw;
            max-width: 1200px;
            height: 70vh;
            border-radius: 15px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.15);
            background-color: var(--browsercontainerbackground-color);
            display: flex;
            flex-direction: column;
      border: 1em solid #333;/*alt option #BBBCBE*/
        }

        /* Browser-like top bar */
        .browser-header {
            background-color: var(--drakgrey-color);
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            border-bottom: 1px solid var(--browserheaderborderbottom-color);
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        .browser-header .browser-buttons {
            display: flex;
            gap: 8px;
        }

        .browser-header .browser-buttons div {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .close-btn {
            background-color: #f96256;
        }

        .minimize-btn {
            background-color: #fdbc40;
        }

        .maximize-btn {
            background-color: #34c84a;
        }

        .url-bar {
            flex-grow: 1;
            height: 28px;
            margin: 0 10px;
            display: flex;
            align-items: center;
            background-color: var(--urlbarbackground-color);
            border-radius: 8px;
            padding: 0 10px;
            font-size: 14px;
            color: #666;
        }

        .url-bar input {
            width: 100%;
            border: none;
            background: transparent;
            outline: none;
            color: var(--urlbarcolor-color);
            font-size: 14px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-group button {
            background-color: #007aff;/*333*/
            color: #fff;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        /*.btn-group button:hover {
            background-color: #555;
        }*/

        .iframe-container {
            flex-grow: 1;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            overflow: hidden;
            background-color: var(--background-color);
        }
        .line-number-input{
          color: var(--black-color);
              width: 6vh;
              height: 6vh;
              min-width: 40px;
              min-height: 40px;
              background: var(--white-color);
              text-align: left;
              border: none;
              border-radius: 50%;
              font-weight: bold;
              font-size: 0.85em;
              margin-left: 1%;
              transition: 0.5s;
          padding: 0 2.5vh;
        }
        .line-number-input:focus{
          border-radius: 100px;
          width: 25vw;
          outline: none;
          box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        }
    .code-search-input{
      color: var(--black-color);
          width: 6vh;
          height: 6vh;
          min-width: 40px;
          min-height: 40px;
          background: var(--white-color);
          text-align: left;
          border: none;
          border-radius: 50%;
          font-weight: bold;
          font-size: 0.85em;
          margin-left: 1%;
          transition: 0.5s;
      padding: 0 2.5vh;
    }
    .code-search-input:focus{
      border-radius: 100px;
      width: 25vw;
      outline: none;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    }
    @media(max-width: 700px){
      #view2{
        display: none;
      }
      .view{
        padding: 0;
        height: 85vh;
      }
      /*.code-search-input{
        display: none;
      }*/
      /*#search-check{
        display: none;
      }*/
      .line-number-input:focus{
        position: fixed;
        top: 0;
        left: 0;
        border-radius: 5px;
        width: 100vw;
        outline: none;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        background: var(--seccontainerbackground-color);
      }
      .code-search-input:focus{
          position: fixed;
          top: 0;
          left: 0;
          border-radius: 5px;
          width: 100vw;
          outline: none;
          box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
          background: var(--seccontainerbackground-color);
      }
    }
    #addFile{
      position: fixed;
      right: 5px;
      bottom: 3px;
      color: #000;
          width: 4vh;
          height: 4vh;
          min-width: 40px;
          min-height: 40px;
          background: transparent;
          text-align: center;
          border: none;
          border-radius: 50%;
          font-weight: bold;
          font-size: 1em;
          margin-left: 1%;
          transition: 0.5s;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #addFile:hover{
          background: #f0f0f0;
      }
    #specialbtn{
      transition: 1s;
      justify-content: center;
      background: var(--switchcheckedbackground-color);
      color: #fff;
    }
    #specialbtn:active{
      background: var(--spencialbtnbackground-color);
      color: var(--spencialbtncolor-color);
    }
    #specialbtn:hover{
      background: var(--spencialbtnbackground-color);
      color: var(--spencialbtncolor-color);
    }
    @keyframes rotatesign {
      100%{
        transform: rotate(360deg);
      }
    }
      @keyframes swipeOutLeft {
                0% {
                    transform: translateX(0);
                }
                100% {               
                  transform: translateX(-100%);
                }
            }

      @keyframes swipeInLeft {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(0);
  }
}

      @keyframes swipeOutRight {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(100%);
  }
}

      @keyframes swipeInRight {
  0% {
    transform: translateX(100%);
  }
  100% {
    transform: translateX(0);
  }
}
    .overlay-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--overlaybackground-color); /* Transparente schwarze Wand */
            display: none;/*flex*/
            justify-content: center;
            align-items: center;
      z-index: 1000;
      animation: swipein 0.5s;
        }
    .content-container {
            border: 1px solid var(--rectangleborder);
            background-color: var(--contentcontainer-color);
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); /* Box Shadow */
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 200px)); /* Flexible Spalten */
            gap: 20px;
            width: 80vw;
            max-width: 1200px;
            margin-top: 20px;
            position: relative;
      max-height: 100vh;
      overflow-y: scroll;
        }

        .top-bar {
            grid-column: 1 / -1; /* Macht die Top-Bar über die gesamte Breite des Containers */
            width: 100%;
            background-color: var(--contentcontainer-color);
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
     
        .overlay-close-btn, .overlay-back-btn, .upload-btn, .viewthisfile, .create-file-btn {
            background-color: var(--contentcontainer-color);/*--lightgrey-color*/
            border: 1px solid var(--rectangleborder);/*--overlayborder-color*/
            color: var(--overlaycolor-color);
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
        }
        .overlay-close-btn {
          display: inline-block;
        }
        .overlay-back-btn {
          display: none;
        }
        @media(max-width: 700px){
          .overlay-close-btn {
            display: none;
          }
          .overlay-back-btn {
            display: inline-block;
          }
        }


        .rectangle {
            background-color: var(--contentcontainer-color); /* --lightgrey-color */
            border: 1px solid var(--rectangleborder);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 150px;
            border-radius: 5px;
            color: var(--rectangleborder); /* Textfarbe */
            font-size: 18px;
            position: relative;
            min-width: 200px;
            transition: background 0.5s;
      white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        @keyframes easeinanimationfrb {
            0% {
                transform: translateY(-100%);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .rectangle-buttons {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none;
        }

        .rectangle:hover .rectangle-buttons {
            display: flex;
            gap: 10px;
        }

        .rectangle.enlarged .rectangle-buttons {
            display: flex;
            gap: 10px;
        }

        .download-btn, .delete-btn, .close, .edit-btn{
            background-color: var(--contentcontainer-color);/*--lightgrey-color*/
            border: 1px solid var(--rectangleborder);/*--overlayborder-color*/
            color: var(--overlaycolor-color);
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 14px;
            animation: easeinanimationfrb 0.3s;
        }

        .download-btn {
            display: none;
        }

    @keyframes easeinanimationfin {
            0% {
                transform: translateY(100%);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .image-name {
            display: none;
            position: absolute;
            color: rgba(255, 255, 255, 0.7);/*#999999*/
            font-size: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 5px;
            border-radius: 3px;
      animation: easeinanimationfin 0.3s;
      transition: 0.5s;
      width: 100%;
      height: 100%;
      text-align: center;
      justify-content: center;
      align-items: center;
      white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .rectangle:hover .image-name {
            display: flex;
        }

        .rectangle.enlarged .image-name {
            display: flex;
      color: rgba(255, 255, 255, 0.7);
        }

        .rectangle.enlarged .rectangle-buttons .download-btn {
            display: inline-block;
        }

        .rectangle.enlarged {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 80vw;
            height: 80vh;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        .close {
            position: absolute;
            top: 5px;
            left: 5px;
            display: none;
        }

        .rectangle.enlarged .close {
            display: block;
        }

        @media (max-width: 768px) {
            .content-container {
                width: 100vw;
                height: 100vh;
                grid-template-columns: repeat(2, 1fr);
                overflow-y: auto;
            }
      .rectangle{
        transition: 0.5s;
      }
            .rectangle.enlarged {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: 1000;
                transform: none;
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            }
        }
        @media (max-width: 500px) {
            .content-container {
                width: 100vw;
                height: 100vh;
                grid-template-columns: repeat(1, 1fr);
                overflow-y: auto;
            }
      .rectangle{
        transition: 0.5s;
      }
        }

    .closeviewthisfilebtn {
      height: 6vh;
      width: 6vh;
      background: var(--transparentshade-color);
      border: none;
      border-radius: 50%;
      display: none;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: var(--black-color);
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 2vh;
      z-index: 1112;
    }

    .codesearchresults{
      font-size: 1em;
      background: var(--seccontainerbackground-color);
      width: 25vw;
      border-radius: 5px;
      border: none;var(--switchcheckedbackground-color);
      position: absolute;
      display: none;
      color: var(--black-color);
      flex-direction: column;
      max-height: 50vh;
      overflow-y: scroll;
      word-break: break-word;
    }
    .codesearchresults .result{
      padding: 10px;
      margin-top: 2px;
      background: var(--seccontainerlinebackground-color);
      color: var(--black-color);
      border-radius: 5px;
      word-break: break-word;
    }
    .codesearchresults .result .highlight{
      background: var(--switchcheckedbackground-color);
      font-size: 0.8em;
      padding: 0.1em;
      border-radius: 5px;
      display: inline-block;
      color: #fff;
    }
    @media(max-width: 700px){
        .codesearchresults{
            width: 100vw;
        }
    }
    .lineoptions {
      display: none;
      padding: 0.1em;
      background: var(--seccontainerbackground-color);
      color: var(--black-color);
      border-radius: 100px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    }
    .lineoptions button{
      color: var(--black-color);
          width: 5vh;
          height: 5vh;
          min-width: 40px;
          min-height: 40px;
          background: var(--seccontainerbackground-color);
          text-align: center;
          border: none;
          border-radius: 50%;
          font-weight: bold;
          font-size: 0.70em;
          transition: 0.5s;
    }
    .lineoptions button:hover{
      background: var(--seccontainerlinebackground-color);
    }








        #overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: var(--fileloadingoverlaybackground-color);
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          z-index: 1500;
          visibility: hidden;
          opacity: 0;
          transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #overlay.active {
          visibility: visible;
          opacity: 1;
        }

        .progress-bar-container {
          width: 80%;
          max-width: 400px;
          background: var(--loadingbarbackground-color);
          border-radius: 5px;
          overflow: hidden;
          margin-bottom: 10px;
        }

        .progress-bar {
          height: 20px;
          width: 0;
          background: var(--loadingbarloadedbackground-color);
          transition: width 0.5s ease;
        }

        .progress-text {
          color: #fff;
          text-align: center;
          margin-top: 10px;
          font-size: 16px;
        }

        .checkmark {
          font-size: 50px;
          color: white;
          display: none;
          margin-bottom: 10px;
        }

        .checkmark.visible {
          display: block;
        }

        #custom-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* Semi-transparentes Schwarz */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1400;
            animation: fadeInOverlay 0.3s ease-in-out; /* Overlay fade-in Animation */
        }

        /* Dialog - Zentrale Box */
        #custom-dialog {
            background: var(--seccontainerbackground-color);
            padding: 30px;
	    border: 1px solid var(--rectangleborder);
            border-radius: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px; /* Max-Breite der Box */
            text-align: center;
            position: relative;
            animation: fadeInDialog 0.4s ease-in-out; /* Box fade-in Animation */
        }

        /* Schließen-Button */
        #close-dialog {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-size: 24px;
            color: var(--rectangleborder);
            transition: color 0.2s;
        }

        /* Nachricht */
        #custom-message {
            font-size: 18px;
            color: var(--black-color);
            margin-bottom: 20px;
            padding: 10px;
            text-align: left;
            max-height: 200px;
            overflow: scroll;
        }

        /* Prompt Eingabe-Container */
        #prompt-input-container {
            margin-top: 15px;
        }

        /* Eingabefeld für prompt */
        #custom-input {
            width: 95%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--rectangleborder);
            font-size: 16px;
            margin-bottom: 15px;
            /*box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);*/
            color: var(--black-color);
            background: transparent;
        }
        #custom-input:focus{
            outline: none;
        }

        /* Button für Submit und OK */
        #close-alert, #submit-prompt {
            margin-top: 10px;
            padding: 12px;
            width: 100%;
            background-color: var(--spencialbtnbackground-color); /*#007BFF;*/
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        /*#close-alert:hover, #submit-prompt:hover {
            background-color: var(--button-disabled-background-color);
            color: var(--text-color);
        }*/

        /* Animationen */
        @keyframes fadeInOverlay {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInDialog {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }


    </style>

</head>
<body>
    <!-- Main content container with sections -->
  <!-- ☼ -->
    <div class="container" id="container">
        <div class="section" id="section0">
            <div class="editor-selected-line-btns">
                  <button class="eslbtn disabled" id="deletebtn" onclick="deleteSelectedLines(); changedeletebtn(this);">⌧</button><button class="eslbtn disabled" id="importantPinbtn" onclick="importantselectedlines()">⚠</button><button class="eslbtn disabled" id="upbtn" onclick="moveselectedlineup()">↑</button><button class="eslbtn disabled" id="downbtn" onclick="moveselectedlinedown()">↓</button><button class="eslbtn disabled" id="sleapbtn" onclick="restselectedline()">☾</button><button class="eslbtn disabled" id="copybtn" onclick="changedeletebtn(this);copyselectedlinetexts();">□</button><input type="text" class="code-search-input" id="code-search-input" oninput="searchcode(this)" onblur="hidecodesearchresults()" onfocus="searchcode(this)" placeholder="⌕"></div>
            <div class="code-editor-container" id="linenumberingon" onkeydown="handleKeyDown(event)" onpaste="handlePaste(event)">
                <div id="1" class="code-editor-line" contenteditable="true"></div>
            </div>
            <div class="code-editor-btns">
                  <button class="code-editor-btn" id="deletebtn" onclick="deleteAllLines(); changedeletebtn(this);">⌧</button><button class="code-editor-btn" id="importantPinbtn" onclick="importantalllines()">⚠</button><button class="code-editor-btn" id="leftbtn" onclick="unselectalllines()">←</button><button class="code-editor-btn" id="rightbtn" onclick="unfoldalllines()">→</button><button class="code-editor-btn" id="unsleeplines" onclick="unsleepalllines()">○</button><button class="code-editor-btn" id="copybtn" onclick="changedeletebtn(this);copyalllinetexts();">□</button><input type="text" class="line-number-input" id="line-number-input" onkeydown="checkiflinenumberinputkeydownisenter(event)" placeholder="⌕ line number"></div>

    </div>
    <div class="section" id="section1">
        <div class="editor-selected-line-btns">
              <button class="eslbtn disabled" id="deletebtn" onclick="deleteSelectedLines(); changedeletebtn(this);">⌧</button><button class="eslbtn disabled" id="importantPinbtn" onclick="importantselectedlines()">⚠</button><button class="eslbtn disabled" id="upbtn" onclick="moveselectedlineup()">↑</button><button class="eslbtn disabled" id="downbtn" onclick="moveselectedlinedown()">↓</button><button class="eslbtn disabled" id="sleapbtn" onclick="restselectedline()">☾</button><button class="eslbtn disabled" id="copybtn" onclick="changedeletebtn(this);copyselectedlinetexts();">□</button><input type="text" class="code-search-input" id="code-search-input" oninput="searchcode(this)" onblur="hidecodesearchresults()" onfocus="searchcode(this)" placeholder="⌕"></div>
            <div class="code-editor-container" id="linenumberingon" onkeydown="handleKeyDown(event)" onpaste="handlePaste(event)">
                <div id="2" class="code-editor-line" contenteditable="true"></div>
            </div>
        <div class="code-editor-btns">
              <button class="code-editor-btn" id="deletebtn" onclick="deleteAllLines(); changedeletebtn(this);">⌧</button><button class="code-editor-btn" id="importantPinbtn" onclick="importantalllines()">⚠</button><button class="code-editor-btn" id="leftbtn" onclick="unselectalllines()">←</button><button class="code-editor-btn" id="rightbtn" onclick="unfoldalllines()">→</button><button class="code-editor-btn" id="unsleeplines" onclick="unsleepalllines()">○</button><button class="code-editor-btn" id="copybtn" onclick="changedeletebtn(this);copyalllinetexts();">□</button><input type="text" class="line-number-input" id="line-number-input" onkeydown="checkiflinenumberinputkeydownisenter(event)" placeholder="⌕ line number"></div>

    </div>
    <div class="section" id="section2">
        <div class="editor-selected-line-btns">
              <button class="eslbtn disabled" id="deletebtn" onclick="deleteSelectedLines(); changedeletebtn(this);">⌧</button><button class="eslbtn disabled" id="importantPinbtn" onclick="importantselectedlines()">⚠</button><button class="eslbtn disabled" id="upbtn" onclick="moveselectedlineup()">↑</button><button class="eslbtn disabled" id="downbtn" onclick="moveselectedlinedown()">↓</button><button class="eslbtn disabled" id="sleapbtn" onclick="restselectedline()">☾</button><button class="eslbtn disabled" id="copybtn" onclick="changedeletebtn(this);copyselectedlinetexts();">□</button><input type="text" class="code-search-input" id="code-search-input" oninput="searchcode(this)" onblur="hidecodesearchresults()" onfocus="searchcode(this)" placeholder="⌕"></div>
            <div class="code-editor-container" id="linenumberingon" onkeydown="handleKeyDown(event)" onpaste="handlePaste(event)">
                <div id="3" class="code-editor-line" contenteditable="true"></div>
            </div>
        <div class="code-editor-btns">
              <button class="code-editor-btn" id="deletebtn" onclick="deleteAllLines(); changedeletebtn(this);">⌧</button><button class="code-editor-btn" id="importantPinbtn" onclick="importantalllines()">⚠</button><button class="code-editor-btn" id="leftbtn" onclick="unselectalllines()">←</button><button class="code-editor-btn" id="rightbtn" onclick="unfoldalllines()">→</button><button class="code-editor-btn" id="unsleeplines" onclick="unsleepalllines()">○</button><button class="code-editor-btn" id="copybtn" onclick="changedeletebtn(this);copyalllinetexts();">□</button><input type="text" class="line-number-input" id="line-number-input" onkeydown="checkiflinenumberinputkeydownisenter(event)" placeholder="⌕ line number"></div>

    </div>
    <div class="section viewcontainer" id="section3">
      <div class="swipe-container">

            <div class="view">
                <div class="mobile-container">

                    <div class="safari-header">
                        <div class="safari-buttons">
                            <div class="back-btn"></div>
                        </div>
                        <div class="url-bar">
                            <input type="text" id="mobile-url-input" placeholder="file..." list="filenameoptions">
                <datalist id="filenameoptions">
                  <option id="option0" value="index.html"></option>
                  <option id="option1" value="styles.css"></option>
                  <option id="option2" value="script.js"></option>
                </datalist>
                        </div>
                        <div class="action-btn" onclick="textCode('mobile-url-input', 'mobile-frame')">⌕</div>
                    </div>


                    <div class="iframe-container">
                        <iframe id="mobile-frame" loading="lazy"></iframe>
                    </div>
                </div>
            </div>


            <div class="view" id="view2">
                <div class="browser-container">

                    <div class="browser-header">
                        <div class="browser-buttons">
                            <div class="close-btn"></div>
                            <div class="minimize-btn"></div>
                            <div class="maximize-btn"></div>
                        </div>
                        <div class="url-bar">
                            <input type="text" id="computer-url-input" placeholder="file..." list="filenameoptions">

                        </div>
                        <div class="btn-group">
                            <button onclick="textCode('computer-url-input', 'computer-frame')">⌕</button>
                        </div>
                    </div>


                    <div class="iframe-container">
                        <iframe id="computer-frame" loading="lazy"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

  <div class="codesearchresults">
    no results
  </div>

  <div class="lineoptions">
    <button onclick="swipethislineleft()">←</button>
    <button onclick="closelineoptionscontainer()">×</button>
    <button onclick="swipethislineright()">→</button>
  </div>

    <!-- Navigation Bar -->
    <div class="nav-bar" id="nav-bar">
        <div data-index="0" class="nav-dot filedot navdot0" onclick="dotonclick()">
            <input class="filePathInput" type="text" onblur="onfilepathinputblur(this)" value="index.html">
        </div>
    <div data-index="1" class="nav-dot filedot navdot1" onclick="dotonclick()">
            <input class="filePathInput" type="text" onblur="onfilepathinputblur(this)" value="styles.css">
        </div>
    <div data-index="2" class="nav-dot filedot navdot2" onclick="dotonclick()">
            <input class="filePathInput" type="text" onblur="onfilepathinputblur(this)" value="script.js">
      <!--oninput="handleFileNameInputChange(this)"-->
    </div>
    <div data-index="3" class="nav-dot navdot3" id="view-nav-dot" onclick="dotonclick()">
            <input class="filePathInput" type="text" value="view">
        </div>
    </div>
  <!--<span id="addFile" onclick="createCodeEditorSection()">+</span>-->
  <div class="seccontainer">
    <div class="seccontainer-line">
      <label class="switch">
                <input type="checkbox" class="switchbox" data-checked="copybtn" onchange="updatecheckboxed(this)" checked>
                <span class="slider"></span>
            </label> copy
    </div>
    <div class="seccontainer-line">
        <label class="switch">
                <input type="checkbox" class="switchbox" data-checked="deletebtn" onchange="updatecheckboxed(this)" checked>
                <span class="slider"></span>
            </label> delete
    </div>
    <div class="seccontainer-line">
        <label class="switch">
                <input type="checkbox" class="switchbox" data-checked="downbtn" onchange="updatecheckboxed(this)" checked>
                <span class="slider"></span>
            </label> move down
    </div> 
    <div class="seccontainer-line">
        <label class="switch">
                <input type="checkbox" class="switchbox" data-checked="upbtn" onchange="updatecheckboxed(this)" checked>
                <span class="slider"></span>
            </label> move up
    </div> 
    <div class="seccontainer-line">
        <label class="switch">
                <input type="checkbox" class="switchbox" data-checked="importantPinbtn" onchange="updatecheckboxed(this)" checked>
                <span class="slider"></span>
            </label> highlight
    </div>
    <div class="seccontainer-line">
        <label class="switch">
                <input type="checkbox" class="switchbox" data-checked="sleapbtn" onchange="updatecheckboxed(this)" checked>
                <span class="slider"></span>
            </label> sleep
    </div>
    <div class="seccontainer-line">
        <label class="switch">
                <input type="checkbox" class="switchbox" data-checked="unsleeplines" onchange="updatecheckboxed(this)" checked>
                <span class="slider"></span>
            </label> unsleep
    </div>
    <div class="seccontainer-line" id="search-check">
        <label class="switch">
                <input type="checkbox" class="switchbox" data-checked="code-search-input" onchange="updatecheckboxed(this)" checked>
                <span class="slider"></span>
            </label> search
    </div>
      <div class="seccontainer-line" id="search-check">
            <label class="switch">
                    <input type="checkbox" class="switchbox" data-checked="line-number-input" onchange="updatecheckboxed(this)" checked>
                    <span class="slider"></span>
                </label> teleport
        </div>
    <div class="seccontainer-line">
        <label class="switch">
                <input type="checkbox" class="switchbox" data-update-id="linenumbering" onchange="updatelinenumbercheckbox(this)" checked>
                <span class="slider"></span>
            </label> line numbers
    </div>
    <!--<div class="seccontainer-line" id="specialbtn" onclick="deleteAllLines()">
        clear
    </div>-->
    <div class="seccontainer-line" id="specialbtn" onclick="deleteAllEmptyLines()">
        delete empty lines
    </div>
    <div class="seccontainer-line" id="specialbtn" onclick="deleteAllCommentsInLines()">
        delete comments
    </div>
  </div>
  <div class="closeviewthisfilebtn" onclick="closeviewthisfile()">×</div>
  <div class="overlay-container" onclick="hideelement('class', 'overlay-container', event)">
        <!-- Content Container (mit Top Bar drin) -->
        <div class="content-container">
            <!-- Top Bar -->
            <div class="top-bar">
                <button class="overlay-back-btn" onclick="hideelement('class', 'overlay-container', event)">×</button>
                <button class="overlay-close-btn" onclick="hideelement('class', 'overlay-container', event)">close</button>
        <input type="file" id="fileInput" style="display: none;" accept=".txt, .css, .js, .html, image/*" multiple>
                <button onclick="clickthiselement('#fileInput')" class="upload-btn">upload</button>
        <button class="viewthisfile" onclick="viewthisfile()">view</button>
				<button class="create-file-btn" onclick="requestcreatenewfile()">+</button>
            </div>

            <!-- Rechtecke (Inhalt) -->

            <div class="rectangle" id="rectangle0">
                <span>index.html</span>
                <div class="rectangle-buttons">
                    <button class="download-btn" onclick="downloadFile('index.html')">Download</button>
                    <button class="delete-btn" style="display: none;" onclick="deletethisfile('0')">Delete</button>
                    <button class="edit-btn" onclick="editthisfile('0')">Edit</button>
                </div>
                <button class="close">×</button>
            </div>
            <div class="rectangle" id="rectangle1">
                <span>styles.css</span>
                <div class="rectangle-buttons">
                    <button class="download-btn" onclick="downloadFile('styles.css')">Download</button>
                    <button class="delete-btn" onclick="deletethisfile('1')">Delete</button>
                    <button class="edit-btn" onclick="editthisfile('1')">Edit</button>
                </div>
                <button class="close">×</button>
            </div>
            <div class="rectangle" id="rectangle2">
                <span>script.js</span>
                <div class="rectangle-buttons">
                    <button class="download-btn" onclick="downloadFile('script.js')">Download</button>
                    <button class="delete-btn" onclick="deletethisfile('2')">Delete</button>
                    <button class="edit-btn" onclick="editthisfile('2')">Edit</button>
                </div>
                <button class="close">×</button>
            </div>
            <div class="rectangle" id="image-rectangle" data-name="Image" data-type="png" style="background-image: url(Plants_fm.jpg); background-size: cover; background-position: center;">
                <span class="image-name">Image.png</span>
                <div class="rectangle-buttons">
                    <button class="download-btn">Download</button>
                    <button class="delete-btn" onclick="deleteImage(this)">Delete</button>
                </div>
                <button class="close">×</button>
            </div>
        </div>
    </div>

    <div id="custom-overlay" style="display: none;">
        <div id="custom-dialog">
            <span id="close-dialog">&times;</span>
            <p id="custom-message"></p>
            <div id="prompt-input-container" style="display: none;">
                <input type="text" id="custom-input" placeholder="Enter a value">
                <button id="submit-prompt">Submit</button>
            </div>
            <button id="close-alert">OK</button>
        </div>
    </div>
    <div id="overlay">
      <div class="progress-bar-container" id="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <div class="checkmark" id="checkmark">✓</div>
      <div class="progress-text" id="progress-text">Analyzing</div>
    </div>


    <script>
        const overlay = document.getElementById('custom-overlay');
        const messageBox = document.getElementById('custom-message');
        const closeAlertButton = document.getElementById('close-alert');
        const promptInputContainer = document.getElementById('prompt-input-container');
        const promptInput = document.getElementById('custom-input');
        const submitPromptButton = document.getElementById('submit-prompt');
        const closeDialog = document.getElementById('close-dialog');

        // Function to show a custom alert

        function showAlert(message) {
            messageBox.textContent = message;
            promptInputContainer.style.display = 'none'; // Hide the input for alerts
            closeAlertButton.style.display = 'block'; // Show the OK button
            overlay.style.display = 'flex'; // Show the overlay
        }

        // Function to show a custom prompt
        function showPrompt(message, callback) {
            messageBox.textContent = message;
            promptInputContainer.style.display = 'block'; // Show the input for prompts
            closeAlertButton.style.display = 'none'; // Hide the OK button for prompts
            overlay.style.display = 'flex'; // Show the overlay

            submitPromptButton.onclick = () => {
                const inputValue = promptInput.value;
                callback(inputValue); // Return the input value to the callback function
                closeCustomDialog();
            };
        }

        // Function to close the custom dialog
        function closeCustomDialog() {
            overlay.style.display = 'none'; // Hide the overlay
            promptInput.value = ''; // Clear the input value
        }

        // Event listeners for closing the dialog
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) { // Close if the background (overlay) is clicked
                closeCustomDialog();
            }
        });

        closeAlertButton.addEventListener('click', closeCustomDialog);
        closeDialog.addEventListener('click', closeCustomDialog);


        
        let isloadingfiles = false;
        let isloadingimages = false;
        function startLoading() {
            const overlay = document.getElementById('overlay');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const checkmark = document.getElementById('checkmark');
            const progressContainer = document.getElementById('progress-container');

            // Reset to initial state
            overlay.classList.add('active');
            progressBar.style.width = '0%';
            progressContainer.style.display = 'block';
            checkmark.classList.remove('visible');
            progressText.textContent = 'Analyzing';

            const steps = [
              { percent: 0, text: 'Reserving' },
              { percent: 25, text: 'Creating environment' },
              { percent: 50, text: 'Linking' },
              { percent: 75, text: 'Formatting' },
              { percent: 100, text: 'Loading complete' },
            ];

            let stepIndex = 0;

            function updateStep() {
              if (stepIndex < steps.length) {
                const step = steps[stepIndex];
                progressBar.style.width = `${step.percent}%`;
                progressText.textContent = step.text;

                if (step.percent === 100) {
                  progressContainer.style.display = 'none'; // Hide progress bar
                  checkmark.classList.add('visible');      // Show checkmark
                }

                stepIndex++;
                setTimeout(updateStep, 1000); // Update every 1 second
              } else {
                setTimeout(() => {
                  overlay.classList.remove('active');
                }, 500); // Hide overlay after completion
              }
            }

            updateStep();
        }
        function startLoadingImages() {
            const overlay = document.getElementById('overlay');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const checkmark = document.getElementById('checkmark');
            const progressContainer = document.getElementById('progress-container');

            // Reset to initial state
            overlay.classList.add('active');
            progressBar.style.width = '0%';
            progressContainer.style.display = 'block';
            checkmark.classList.remove('visible');
            progressText.textContent = 'Reserving';

            const steps = [
              { percent: 0, text: 'Processing' },
              { percent: 50, text: 'Adding' },
              { percent: 100, text: 'Loading complete' },
            ];

            let stepIndex = 0;

            function updateStep() {
              if (stepIndex < steps.length) {
                const step = steps[stepIndex];
                progressBar.style.width = `${step.percent}%`;
                progressText.textContent = step.text;

                if (step.percent === 100) {
                  progressContainer.style.display = 'none'; // Hide progress bar
                  checkmark.classList.add('visible');      // Show checkmark
                }

                stepIndex++;
                setTimeout(updateStep, 1000); // Update every 1 second
              } else {
                setTimeout(() => {
                  overlay.classList.remove('active');
                }, 500); // Hide overlay after completion
              }
            }

            updateStep();
        }
        function startLoadingImagesAndFiles() {
            const overlay = document.getElementById('overlay');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const checkmark = document.getElementById('checkmark');
            const progressContainer = document.getElementById('progress-container');

            // Reset to initial state
            overlay.classList.add('active');
            progressBar.style.width = '0%';
            progressContainer.style.display = 'block';
            checkmark.classList.remove('visible');
            progressText.textContent = 'Analyzing files';

            const steps = [
              { percent: 0, text: 'Reserving' },
              { percent: 25, text: 'Creating environment' },
              { percent: 50, text: 'Linking' },
              { percent: 75, text: 'Formatting' },
              { percent: 100, text: 'Loading complete' },
            ];

            let stepIndex = 0;

            function updateStep() {
              if (stepIndex < steps.length) {
                const step = steps[stepIndex];
                progressBar.style.width = `${step.percent}%`;
                progressText.textContent = step.text;

                if (step.percent === 100) {
                  progressContainer.style.display = 'none'; // Hide progress bar
                  checkmark.classList.add('visible');      // Show checkmark
                }

                stepIndex++;
                setTimeout(updateStep, 1000); // Update every 1 second
              } else {
                setTimeout(() => {
                  overlay.classList.remove('active');
                }, 500); // Hide overlay after completion
              }
            }

            updateStep();
        }
    /*document.querySelectorAll('.filedot').forEach(rect => {
      rect.querySelector('.filePathInput').addEventListener('input', () => {
        handleFileNameInputChange(rect);
      });
    });*/
    function hidecodesearchresults() {
      setTimeout(() => {
          const codesearchresults = document.querySelector('.codesearchresults');
          codesearchresults.style.display = "none";
      }, 500);
    }
    document.getElementById('fileInput').addEventListener('change', function(event) {
        const files = event.target.files;

        // Iteriere durch die ausgewählten Dateien
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const filePath = file.name;
            // Prüfen, ob die Datei ein Bild ist
            if (file.type.startsWith('image/')) {
                isloadingimages = true;
                addNewImage(filePath, URL.createObjectURL(file), file); // Bild hinzufügen
            } else if (file.type === 'text/plain' || file.type === 'text/css' || file.type === 'application/javascript' || file.type === 'text/html') {
                let allfilenames = Array.from(document.querySelectorAll('.filedot .filePathInput')).map(input => input.value);
                if (!allfilenames.includes(filePath)) {
                  isloadingfiles = true;
                  addNewFile(filePath, file); // Text oder Code-Datei hinzufügen
                }
            }
        }
        if (isloadingfiles == true && isloadingimages == false) {
            isloadingfiles = false;
            isloadingimages = false;
            startLoading();
        }else if (isloadingfiles == false && isloadingimages == true) {
            isloadingfiles = false;
            isloadingimages = false;
            startLoadingImages();
        }else if (isloadingfiles == true && isloadingimages == true) {
            isloadingfiles = false;
            isloadingimages = false;
            startLoadingImagesAndFiles();
        }
    });

    function clickthiselement(elementidorclass){
      document.querySelector(elementidorclass).click();
    }

    const imagerectangle = document.getElementById('image-rectangle');
    imagerectangle.querySelector('.download-btn').addEventListener('click', () => {
      const a = document.createElement('a');
a.href = imagerectangle.textContent; // Direkt den Base64-URL-String verwenden
a.download = imagerectangle.textContent;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
    });

    function addNewImage(imagePath, imageUrl, file) {
// Der Dateiname wird aus dem Pfad extrahiert
const fileName = imagePath.split('/').pop(); // Holt den Dateinamen aus dem Pfad

// Container, in den das neue Rectangle hinzugefügt wird
const contentContainer = document.querySelector('.content-container');

// Neues Rectangle-Element erstellen
      function getImageInfo(filePath) {

          const fileName = filePath.split('/').pop();

          const [name, format] = fileName.split(/\.(?=[^\.]+$)/);

            return {
              name: name,
              format: format
          };
      }
const newRectangle = document.createElement('div');
newRectangle.classList.add('rectangle');
      let newfilenameinfo = getImageInfo(fileName);
newRectangle.setAttribute('data-name', newfilenameinfo.name);
      newRectangle.setAttribute('data-type', newfilenameinfo.format);
newRectangle.style.backgroundImage = `url('${imageUrl}')`;
newRectangle.style.backgroundSize = 'cover';
newRectangle.style.backgroundPosition = 'center';

// Inhalt des Rectangles
newRectangle.innerHTML = `<span class="image-name">${fileName}</span>
<div class="rectangle-buttons"><button class="download-btn">Download</button><button class="delete-btn" onclick="deleteImage(this)">Delete</button></div>
<button class="close">×</button>`;

// Rectangle in den Content-Container einfügen
contentContainer.appendChild(newRectangle);

      newRectangle.querySelector('.download-btn').addEventListener('click', () => {
        downloadImage(file);
      });

      let timer;

            // Touch and mouse handling
            newRectangle.querySelector('.close').addEventListener('click', () => {
                newRectangle.classList.remove('enlarged');
            });
            newRectangle.addEventListener('mousedown', startEnlarge);
            newRectangle.addEventListener('touchstart', startEnlarge);

            newRectangle.addEventListener('mouseup', stopEnlarge);
            newRectangle.addEventListener('mouseleave', stopEnlarge);
            newRectangle.addEventListener('touchend', stopEnlarge);

            function startEnlarge(event) {
                timer = setTimeout(() => {
                    newRectangle.classList.add('enlarged');
                }, 700); // 1 Sekunde halten
            }

            function stopEnlarge() {
                clearTimeout(timer); // Timer stoppen, wenn das Bild nicht lange genug gehalten wird
            }
}

// Hilfsfunktion zum Löschen eines Rectangles
function deleteImage(element) {
const rectangle = element.closest('.rectangle');
rectangle.remove();
}

// Hilfsfunktion zum Herunterladen eines Bildes
        function downloadImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const fileUrl = e.target.result;
                const a = document.createElement('a');
                a.href = fileUrl; // Direkt den Base64-URL-String verwenden
                a.download = file.name; // Der Name der Datei wird verwendet
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };
            reader.readAsDataURL(file); // Der FileReader liest die Datei korrekt
        }



        function requestcreatenewfile() {
            showPrompt('file path:', (filename) => {
                let allfilenames = Array.from(document.querySelectorAll('.filedot .filePathInput')).map(input => input.value);
                if (!allfilenames.includes(filename)){
                    createNewFile(filename);
				        }
            });
        }
        async function addNewFile(filename, file) {
            let allfilenames = Array.from(document.querySelectorAll('.filedot .filePathInput')).map(input => input.value);
            if (allfilenames.includes(filename)){
                return;
            }
const container = document.getElementById('container');
const navBar = document.getElementById('nav-bar');

// Create a new section
const newSection = document.createElement('div');
newSection.classList.add('section');
newSection.id = `section${container.children.length}`;
newSection.innerHTML = `<div class="editor-selected-line-btns"><button class="eslbtn disabled" id="deletebtn" onclick="deleteSelectedLines(); changedeletebtn(this);">⌧</button><button class="eslbtn disabled" id="importantPinbtn" onclick="importantselectedlines()">⚠</button><button class="eslbtn disabled" id="upbtn" onclick="moveselectedlineup()">↑</button><button class="eslbtn disabled" id="downbtn" onclick="moveselectedlinedown()">↓</button><button class="eslbtn disabled" id="sleapbtn" onclick="restselectedline()">☾</button><button class="eslbtn disabled" id="copybtn" onclick="changedeletebtn(this);copyselectedlinetexts();">□</button><input type="text" class="code-search-input" id="code-search-input" oninput="searchcode(this)" onblur="hidecodesearchresults()" onfocus="searchcode(this)" placeholder="⌕"></div></div>
        <div class="code-editor-container" id="linenumberingon" onkeydown="handleKeyDown(event)" onpaste="handlePaste(event)">
            <div id="1" class="code-editor-line" contenteditable="true"></div>
        </div>
        <div class="code-editor-btns"><button class="code-editor-btn" id="deletebtn" onclick="deleteAllLines(); changedeletebtn(this);">⌧</button><button class="code-editor-btn" id="importantPinbtn" onclick="importantalllines()">⚠</button><button class="code-editor-btn" id="leftbtn" onclick="unselectalllines()">←</button><button class="code-editor-btn" id="rightbtn" onclick="unfoldalllines()">→</button><button class="code-editor-btn" id="unsleeplines" onclick="unsleepalllines()">○</button><button class="code-editor-btn" id="copybtn" onclick="changedeletebtn(this);copyalllinetexts();">□</button><input type="text" class="line-number-input" id="line-number-input" onkeydown="checkiflinenumberinputkeydownisenter(event)" placeholder="⌕ line number"></div>`;
container.appendChild(newSection);

      lineoptioncontainerupdate(newSection.querySelector('.code-editor-container'));

// Set up FileReader to read file and add each line to code-editor-container
const reader = new FileReader();
      let body = document.querySelector('body');
reader.onload = (e) => {
const lines = e.target.result.split('\n');// e.target.result.split('\n'); body.innerHTML.split('\n');
const editorContainer = newSection.querySelector('.code-editor-container');
lines.forEach((lineText) => {
const line = document.createElement('div');
line.classList.add('code-editor-line');
line.setAttribute('contenteditable', 'true');
line.innerText = lineText;
editorContainer.appendChild(line);
});
};
reader.readAsText(file);

// Create and add new navigation dot
const newNavDot = document.createElement('div');
newNavDot.classList.add('nav-dot', 'filedot');

newNavDot.setAttribute('data-index', container.children.length - 1);
newNavDot.innerHTML = `
      <input class="filePathInput" type="text" onblur="onfilepathinputblur(this)" value="${filename}">
    `;
      newNavDot.setAttribute('onclick', 'dotonclick()');
navBar.appendChild(newNavDot);

      let filePathInputblablabla = newNavDot.querySelector('.filePathInput');
            let timeout;

        filePathInputblablabla.addEventListener('input', (event) => {
          handleFileNameInputChange(event.target.parentElement);
        });



            filePathInputblablabla.addEventListener('mousedown', startOverlayEnlarge);
            filePathInputblablabla.addEventListener('touchstart', startOverlayEnlarge);

            filePathInputblablabla.addEventListener('mouseup', stopOverlayEnlarge);
            filePathInputblablabla.addEventListener('mouseleave', stopOverlayEnlarge);
            filePathInputblablabla.addEventListener('touchend', stopOverlayEnlarge);

            function startOverlayEnlarge(event) {
                timeout = setTimeout(() => {
                    document.querySelector('.overlay-container').style.display = "flex";
          document.querySelector('.overlay-container').style.animation = "none";
                    void document.querySelector('.overlay-container').offsetWidth; // Trigger reflow
                    document.querySelector('.overlay-container').style.animation = "swipein 0.5s ease-out";
                }, 700);
            }

            function stopOverlayEnlarge() {
                clearTimeout(timeout); // Timer stoppen, wenn das Bild nicht lange genug gehalten wird
            }

// Add file path to datalist
const dataList = document.getElementById('filenameoptions');
const option = document.createElement('option');
option.value = filename;
option.id = `option${newNavDot.getAttribute('data-index')}`;
dataList.appendChild(option);

// Add overlay rectangle with delete and download functionality
const overlayContainer = document.querySelector('.overlay-container .content-container');
const newRectangle = document.createElement('div');
newRectangle.classList.add('rectangle');
newRectangle.innerHTML = `<span>${filename}</span>
<div class="rectangle-buttons">
<button class="download-btn" onclick="downloadFile(${filename})">Download</button>
<button class="delete-btn" onclick="deletethisfile('${container.children.length - 1}')">Delete</button>
<button class="edit-btn" onclick="editthisfile('${container.children.length - 1}')">Edit</button>
</div>
<button class="close">×</button>`;
overlayContainer.appendChild(newRectangle);

// Delete functionality
/*newRectangle.querySelector('.delete-btn').addEventListener('click', () => {
newRectangle.remove();
newNavDot.remove();
newSection.remove();
option.remove();
});*/

// Download functionality
newRectangle.querySelector('.download-btn').onclick = () => {
downloadFile(filename);
}
        /*.querySelector('.download-btn').addEventListener('click', () => {
const a = document.createElement('a');
a.href = `path/to/files/${filename}`;
a.download = filename;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
});*/

      newRectangle.querySelector('.close').addEventListener('click', () => {
                newRectangle.classList.remove('enlarged');
            });

// Touch and mouse handling for enlarging effect
let timer;
newRectangle.addEventListener('mousedown', startEnlarge);
newRectangle.addEventListener('touchstart', startEnlarge);
newRectangle.addEventListener('mouseup', stopEnlarge);
newRectangle.addEventListener('mouseleave', stopEnlarge);
newRectangle.addEventListener('touchend', stopEnlarge);

function startEnlarge() {
timer = setTimeout(() => {
newRectangle.classList.add('enlarged');
}, 700);
}

function stopEnlarge() {
clearTimeout(timer);
}

// Update indices and numbering
await updateDataIndex('nav-bar');
      newNavDot.classList.add('nav-dot', 'navdot' + newNavDot.getAttribute('data-index'));
      newRectangle.id = "rectangle" + newNavDot.getAttribute('data-index');
      navBarremoveeventlistenerscrollandadditagain();
}
        async function createNewFile(filename) {
            const container = document.getElementById('container');
            const navBar = document.getElementById('nav-bar');

            // Create a new section
            const newSection = document.createElement('div');
            newSection.classList.add('section');
            newSection.id = `section${container.children.length}`;
            newSection.innerHTML = `<div class="editor-selected-line-btns"><button class="eslbtn disabled" id="deletebtn" onclick="deleteSelectedLines(); changedeletebtn(this);">⌧</button><button class="eslbtn disabled" id="importantPinbtn" onclick="importantselectedlines()">⚠</button><button class="eslbtn disabled" id="upbtn" onclick="moveselectedlineup()">↑</button><button class="eslbtn disabled" id="downbtn" onclick="moveselectedlinedown()">↓</button><button class="eslbtn disabled" id="sleapbtn" onclick="restselectedline()">☾</button><button class="eslbtn disabled" id="copybtn" onclick="changedeletebtn(this);copyselectedlinetexts();">□</button><input type="text" class="code-search-input" id="code-search-input" oninput="searchcode(this)" onblur="hidecodesearchresults()" onfocus="searchcode(this)" placeholder="⌕"></div></div>
        <div class="code-editor-container" id="linenumberingon" onkeydown="handleKeyDown(event)" onpaste="handlePaste(event)">
            <div id="1" class="code-editor-line" contenteditable="true"></div>
        </div>
        <div class="code-editor-btns"><button class="code-editor-btn" id="deletebtn" onclick="deleteAllLines(); changedeletebtn(this);">⌧</button><button class="code-editor-btn" id="importantPinbtn" onclick="importantalllines()">⚠</button><button class="code-editor-btn" id="leftbtn" onclick="unselectalllines()">←</button><button class="code-editor-btn" id="rightbtn" onclick="unfoldalllines()">→</button><button class="code-editor-btn" id="unsleeplines" onclick="unsleepalllines()">○</button><button class="code-editor-btn" id="copybtn" onclick="changedeletebtn(this);copyalllinetexts();">□</button><input type="text" class="line-number-input" id="line-number-input" onkeydown="checkiflinenumberinputkeydownisenter(event)" placeholder="⌕ line number"></div>`;
            container.appendChild(newSection);

            lineoptioncontainerupdate(newSection.querySelector('.code-editor-container'));

            // Create and add new navigation dot
            const newNavDot = document.createElement('div');
            newNavDot.classList.add('nav-dot', 'filedot');
            newNavDot.setAttribute('data-index', container.children.length - 1);
            newNavDot.innerHTML = `<input class="filePathInput" type="text" onblur="onfilepathinputblur(this)" value="${filename}">`;
            newNavDot.setAttribute('onclick', 'dotonclick()');
            navBar.appendChild(newNavDot);

            let filePathInputblablabla = newNavDot.querySelector('.filePathInput');
            let timeout;

            filePathInputblablabla.addEventListener('input', (event) => {
                handleFileNameInputChange(event.target.parentElement);
            });

            filePathInputblablabla.addEventListener('mousedown', startOverlayEnlarge);
            filePathInputblablabla.addEventListener('touchstart', startOverlayEnlarge);

            filePathInputblablabla.addEventListener('mouseup', stopOverlayEnlarge);
            filePathInputblablabla.addEventListener('mouseleave', stopOverlayEnlarge);
            filePathInputblablabla.addEventListener('touchend', stopOverlayEnlarge);

            function startOverlayEnlarge(event) {
                timeout = setTimeout(() => {
                    document.querySelector('.overlay-container').style.display = "flex";
                    document.querySelector('.overlay-container').style.animation = "none";
                    void document.querySelector('.overlay-container').offsetWidth; // Trigger reflow
                    document.querySelector('.overlay-container').style.animation = "swipein 0.5s ease-out";
                }, 700);
            }

            function stopOverlayEnlarge() {
                clearTimeout(timeout); // Stop timer if interaction is too short
            }

            // Add file path to datalist
            const dataList = document.getElementById('filenameoptions');
            const option = document.createElement('option');
            option.value = filename;
            option.id = `option${newNavDot.getAttribute('data-index')}`;
            dataList.appendChild(option);

            // Add overlay rectangle with delete and download functionality
            const overlayContainer = document.querySelector('.overlay-container .content-container');
            const newRectangle = document.createElement('div');
            newRectangle.classList.add('rectangle');
            newRectangle.innerHTML = `<span>${filename}</span>
<div class="rectangle-buttons">
    <button class="download-btn" onclick="downloadFile('${filename}')">Download</button>
    <button class="delete-btn" onclick="deletethisfile('${container.children.length - 1}')">Delete</button>
    <button class="edit-btn" onclick="editthisfile('${container.children.length - 1}')">Edit</button>
</div>
<button class="close">×</button>`;
            overlayContainer.appendChild(newRectangle);

            newRectangle.querySelector('.download-btn').onclick = () => {
                downloadFile(filename);
            };

            newRectangle.querySelector('.close').addEventListener('click', () => {
                newRectangle.classList.remove('enlarged');
            });

            // Touch and mouse handling for enlarging effect
            let timer;
            newRectangle.addEventListener('mousedown', startEnlarge);
            newRectangle.addEventListener('touchstart', startEnlarge);
            newRectangle.addEventListener('mouseup', stopEnlarge);
            newRectangle.addEventListener('mouseleave', stopEnlarge);
            newRectangle.addEventListener('touchend', stopEnlarge);

            function startEnlarge() {
                timer = setTimeout(() => {
                    newRectangle.classList.add('enlarged');
                }, 700);
            }

            function stopEnlarge() {
                clearTimeout(timer);
            }

            // Update indices and numbering
            await updateDataIndex('nav-bar');
            newNavDot.classList.add('nav-dot', 'navdot' + newNavDot.getAttribute('data-index'));
            newRectangle.id = "rectangle" + newNavDot.getAttribute('data-index');
            navBarremoveeventlistenerscrollandadditagain();
        }



        /*function handleFileNameInputChange(navDot) {
        const option = document.getElementById("option" + navDot.getAttribute('data-index'));
        const rectangle = document.getElementById("rectangle" + navDot.getAttribute('data-index'));
        let rectanglespan = rectangle.querySelector('span');
        const newValue = navDot.querySelector('.filePathInput').value;

        option.value = newValue;
        option.textContent = newValue; // Update displayed text in dropdown
        rectanglespan.innerText = newValue;
        }*/
        function downloadFile(name) {
            // Extract type and filename
            let type = name.split('.').pop();
            let filename = name.split('.').slice(0, -1).join('.');

            // Check if file content exists
            let content = checkiffile(name);
            if (!content) {
                return; // Abort if no content is found
            }

            // Map type to MIME type
            const mimeTypes = {
                html: 'text/html',
                css: 'text/css',
                js: 'application/javascript',
                txt: 'text/plain'
            };

            // Check if the type is valid
            const mimeType = mimeTypes[type];
            if (!mimeType) {
                return; // Abort for unknown types
            }

            // Create a Blob with the content and MIME type
            const blob = new Blob([content], { type: mimeType });

            // Create a temporary link element
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob); // Create a URL for the Blob
            link.download = `${filename}.${type}`; // Set the correct filename

            // Append the link to the document and trigger the download
            document.body.appendChild(link);
            link.click();

            // Clean up
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
        function onfilepathinputblur(inputField) {
    // Erstelle ein Array aller Dateinamen außer dem aktuellen Eingabefeld
    const allFileNames = Array.from(document.querySelectorAll('.filedot .filePathInput'))
        .filter(input => input !== inputField) // Ignoriere das aktuelle Eingabefeld
        .map(input => input.value);

    // Überprüfe, ob der eingegebene Wert bereits existiert
    if (allFileNames.includes(inputField.value)) {
        let baseName = inputField.value;
        let counter = 1;

        // Finde einen einzigartigen Namen, indem eine Zahl angehängt wird
        while (allFileNames.includes(`${counter}_${baseName}`)) {
            counter++;
        }

        // Setze den neuen Namen im Eingabefeld
        inputField.value = `${counter}_${baseName}`;

        // Aktualisiere die Änderungen für das übergeordnete Element
        if (inputField.parentElement){
          handleFileNameInputChange(inputField.parentElement);
        }
    }
}




        function handleFileNameInputChange(navDot) {
            // Find related elements
            const dataIndex = navDot.getAttribute('data-index');
            const option = document.getElementById("option" + dataIndex);
            const rectangle = document.getElementById("rectangle" + dataIndex);

            // Ensure option and rectangle exist
            if (!option || !rectangle) {
                return;
            }

            const filePathInput = navDot.querySelector('.filePathInput');
            const rectanglespan = rectangle.querySelector('span');
            const downloadBtn = rectangle.querySelector('.download-btn');

            // Ensure required child elements exist
            if (!filePathInput || !rectanglespan || !downloadBtn) {
                return;
            }

            // Get and sanitize new value
            const newValue = filePathInput.value.trim();
            if (!newValue) {
                return; // Abort if the new value is empty
            }
            const safeValue = newValue.replace(/['"<>&]/g, '');

            // Update option and rectangle
            option.value = safeValue;
            option.textContent = safeValue;
            rectanglespan.innerText = safeValue;

            // Update download button's action
            downloadBtn.onclick = () => downloadFile(safeValue);
        }



        document.querySelectorAll('.filedot .filePathInput').forEach(rect => {
            rect.addEventListener('input', () => {
                handleFileNameInputChange(rect.parentElement);
            });
        });




    document.querySelectorAll('.rectangle').forEach(rect => {
            let timer;

            // Touch and mouse handling
            rect.querySelector('.close').addEventListener('click', () => {
                rect.classList.remove('enlarged');
            });
            rect.addEventListener('mousedown', startEnlarge);
            rect.addEventListener('touchstart', startEnlarge);

            rect.addEventListener('mouseup', stopEnlarge);
            rect.addEventListener('mouseleave', stopEnlarge);
            rect.addEventListener('touchend', stopEnlarge);

            function startEnlarge(event) {
                timer = setTimeout(() => {
                    rect.classList.add('enlarged');
                }, 700); // 1 Sekunde halten
            }

            function stopEnlarge() {
                clearTimeout(timer); // Timer stoppen, wenn das Bild nicht lange genug gehalten wird
            }
        });

    document.querySelectorAll('.filePathInput').forEach(rect => {
            let timer;

            rect.addEventListener('mousedown', startEnlarge);
            rect.addEventListener('touchstart', startEnlarge);

            rect.addEventListener('mouseup', stopEnlarge);
            rect.addEventListener('mouseleave', stopEnlarge);
            rect.addEventListener('touchend', stopEnlarge);

            function startEnlarge(event) {
                timer = setTimeout(() => {
          updateviewthisfilebtn();
                    document.querySelector('.overlay-container').style.display = "flex";
          document.querySelector('.overlay-container').style.animation = "none";
                    void document.querySelector('.overlay-container').offsetWidth; // Trigger reflow
                    document.querySelector('.overlay-container').style.animation = "swipein 0.5s ease-out";
                }, 700);
            }

            function stopEnlarge() {
                clearTimeout(timer); // Timer stoppen, wenn das Bild nicht lange genug gehalten wird
            }
        });
    function hideelement(type, name, event){
      if (event.target !== event.currentTarget) {
                return;
            }
      if (type == 'class'){
        document.querySelector('.' + name).style.animation = "none";
                void document.querySelector('.' + name).offsetWidth; // Trigger reflow
                document.querySelector('.' + name).style.animation = "swipeout 0.5s ease-out";
                setTimeout(() => {
                    document.querySelector('.' + name).style.display = 'none';
                }, 500);
      }else if (type == 'id'){
        document.querySelector('#' + name).style.animation = "none";
                void document.querySelector('.' + name).offsetWidth; // Trigger reflow
                document.querySelector('#' + name).style.animation = "swipeout 0.5s ease-out";
                setTimeout(() => {
                    document.querySelector('#' + name).style.display = 'none';
                }, 500);
      }
    }
        const navBar = document.getElementById('nav-bar');
        let isDragging = false;
        let startY = 0;
        let currentHeight = 50; // Initial height
      let section = document.getElementById('section0');
      let sectionindex = 0;
      let inputDiv = section.querySelector('.code-editor-container');
        function checkiflinenumberinputkeydownisenter(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Verhindert, dass Enter normale Aktionen ausführt
                let input = event.target;
                let value = input.value.trim();

                if (value !== '') {
                    // Überprüfen, ob es eine gültige Zahl ist
                    if (isNaN(value)) {
                        return;
                    }

                    // Holen der Zeilen im Abschnitt
                    let lines = section.querySelectorAll('.code-editor-line');
                    let lineIndex = parseInt(value, 10) - 1;

                    if (lineIndex >= 0 && lineIndex < lines.length) {
                        let line = lines[lineIndex];

                        // Zeile in den sichtbaren Bereich scrollen
                        line.scrollIntoView({
                            behavior: 'smooth', // Sanftes Scrollen
                            block: 'center',    // Zeile in der Mitte des sichtbaren Bereichs anzeigen
                        });
                    }
                }
            }
        }
        function scrolltolinenumber(linenum){
            let lines = section.querySelectorAll('.code-editor-line');
            let lineIndex = parseInt(linenum);

            if (lineIndex >= 0 && lineIndex < lines.length) {
                let line = lines[lineIndex];

                // Zeile in den sichtbaren Bereich scrollen
                line.scrollIntoView({
                    behavior: 'smooth', // Sanftes Scrollen
                    block: 'center',    // Zeile in der Mitte des sichtbaren Bereichs anzeigen
                });
            }
        }

        /*function deletethisfile(number) {
            // Delete rectangle
            let rectangleToDelete = document.getElementById('rectangle' + number);
            if (rectangleToDelete) {
                rectangleToDelete.remove();
                document.querySelectorAll('.rectangle').forEach((rect, index) => {
                    if (rect.id != 'image-rectangle'){
                        rect.id = "rectangle" + index;
                        rect.querySelector('.rectangle-buttons .delete-btn').setAttribute('onclick', `deletethisfile(${index})`);
                        rect.querySelector('.rectangle-buttons .edit-btn').setAttribute('onclick', `editthisfile(${index})`);
                    }
                });
            }

            // Delete nav-dot
            let navBar = document.getElementById('nav-bar');
            if (navBar) {
                let deletethisnavdot = navBar.querySelector('.nav-dot[data-index="' + number + '"]');
                if (deletethisnavdot) {
                    let filePathInput = deletethisnavdot.querySelector('.filePathInput');
                    let deletethisnavdotvalue = filePathInput ? filePathInput.value : null;
                    deletethisnavdot.remove();

                    document.querySelectorAll('.nav-dot').forEach((navdot, index) => {
                        navdot.classList.remove('navdot' + navdot.getAttribute('data-index'));
                        navdot.classList.add('navdot' + index);
                        navdot.setAttribute('data-index', index);
                    });

                    // Delete option if applicable
                    if (deletethisnavdotvalue) {
                        let filenameOptions = document.getElementById('filenameoptions');
                        if (filenameOptions) {
                            let optionToDelete = document.getElementById("option" + number); //filenameOptions.querySelector('option[value="' + deletethisnavdotvalue + '"]');
                            if (optionToDelete) {
                                optionToDelete.remove();
                            }

                            document.getElementById('filenameoptions').querySelectorAll('option').forEach((option, index) => {
                                option.id = "option" + index;
                            });
                        }
                    }
                }
            }

            // Delete section
            let container = document.getElementById('container');
            if (container) {
                let deletethissection = container.querySelector('.section[id="section' + number + '"]');
                if (deletethissection) {
                    if (section.id == deletethissection.id){
                        let scrolltothisnavdot = document.getElementById('view-nav-dot');
                        if (scrolltothisnavdot){
                            scrolltothisnavdot.scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                    deletethissection.remove();
                    document.querySelectorAll('.section').forEach((sectionv, index) => {
                        sectionv.id = "section" + index;
                    });
                }
            }
        }*/
        function deletethisfile(number) {
            // Delete rectangle
            let rectangleToDelete = document.getElementById('rectangle' + number);
            if (rectangleToDelete) {
                rectangleToDelete.remove();
                document.querySelectorAll('.rectangle').forEach((rect, index) => {
                    if (rect.id !== 'image-rectangle') {
                        rect.id = "rectangle" + index;
                        rect.querySelector('.rectangle-buttons .delete-btn').setAttribute('onclick', `deletethisfile(${index})`);
                        rect.querySelector('.rectangle-buttons .edit-btn').setAttribute('onclick', `editthisfile(${index})`);
                    }
                });
            }

            // Delete nav-dot
            let navBar = document.getElementById('nav-bar');
            if (navBar) {
                let deletethisnavdot = navBar.querySelector('.nav-dot[data-index="' + number + '"]');
                if (deletethisnavdot) {
                    let filePathInput = deletethisnavdot.querySelector('.filePathInput');
                    let deletethisnavdotvalue = filePathInput ? filePathInput.value : null;
                    deletethisnavdot.remove();

                    document.querySelectorAll('.nav-dot').forEach((navdot, index) => {
                        navdot.classList.remove('navdot' + navdot.getAttribute('data-index'));
                        navdot.classList.add('navdot' + index);
                        navdot.setAttribute('data-index', index);
                    });

                    // Delete option if applicable
                    if (deletethisnavdotvalue) {
                        let filenameOptions = document.getElementById('filenameoptions');
                        if (filenameOptions) {
                            let optionToDelete = filenameOptions.querySelector(`option[value="${deletethisnavdotvalue}"]`);
                            if (optionToDelete) {
                                optionToDelete.remove();
                                document.querySelectorAll('#filenameoptions option').forEach((option, index) => {
                                    option.id = "option" + index;
                                });
                            }
                        }
                    }
                }
            }

            // Delete section
            let container = document.getElementById('container');
            if (container) {
                let deletethissection = container.querySelector('.section[id="section' + number + '"]');
                if (deletethissection) {
                    deletethissection.remove();
                    document.querySelectorAll('.section').forEach((sectionv, index) => {
                        sectionv.id = "section" + index;
                    });
                }
            }
        }


        function editthisfile(number){
            /*let scrolltothissection = container.querySelector('.navdot' + number);
            if(scrolltothissection){
                scrolltothissection.scrollIntoView({ behavior: 'smooth' });
            }*/
            let navBar = document.getElementById('nav-bar');
            let scrolltothissection = navBar.querySelector('.nav-dot[data-index="' + number + '"]');
            if (scrolltothissection){
                scrolltothissection.scrollIntoView({ behavior: 'smooth' });
                document.querySelector('.overlay-back-btn').click();
            }
        }
      function updateviewthisfilebtn() {
      if (!section || !section.id){
        return;
      }
        if (section.id == document.querySelector('.viewcontainer').id){
        document.querySelector('.viewthisfile').style.display = 'none';
        
      }else {
        document.querySelector('.viewthisfile').style.display = 'inline-block';
      }
      }
    function deleteAllEmptyLines() {
        const sectionlinecontainer = section.querySelector(".code-editor-container");
        const allsectionlines = sectionlinecontainer.querySelectorAll(".code-editor-line");
        allsectionlines.forEach(line => {
            // Korrigiere den Aufruf von `trim()`
            if (line.innerText.trim() === "") {
                if (section.querySelectorAll(".code-editor-line").length > 1 && !line.classList.contains('hiddenlinesparent')){
                    line.remove();
                }
            }
        });
    }
    function deleteAllCommentsInLines() {
        const sectionlinecontainer = section.querySelector(".code-editor-container");
        const allsectionlines = sectionlinecontainer.querySelectorAll(".code-editor-line");

        allsectionlines.forEach(line => {
            let text = line.innerText;
            text = text.replace(/\/\/.*/g, '');
            text = text.replace(/\/\*[\s\S]*?\*\//g, '');
            line.innerText = text;
        });
    }
    function positionElementAbove(elementToPosition, referenceElement) {
const referenceRect = referenceElement.getBoundingClientRect();
elementToPosition.style.position = 'absolute';
elementToPosition.style.top = `${referenceRect.top - window.innerHeight * 0.06}px`; // 3vh unterhalb
elementToPosition.style.right = `${referenceRect.left + (referenceRect.width - elementToPosition.offsetWidth) / 2}px`;
}
    let targetElementv = null;
    document.querySelectorAll('.code-editor-container').forEach(linecontainer => {
      lineoptioncontainerupdate(linecontainer);
    });
    function lineoptioncontainerupdate(linecontainer){

      linecontainer.addEventListener('mousedown', function(event) {
const targetElement = event.target;
targetElementv = targetElement;
targetElement.holdTimer = setTimeout(() => {
performLongPressAction(targetElement);
document.querySelector('.lineoptions').style.display = 'block';
}, 700); // 700 ms halten, um Aktion auszulösen
});

// Mouseup, um das lange Drücken abzubrechen, wenn die Maustaste losgelassen wird
linecontainer.addEventListener('mouseup', function(event) {
const targetElement = event.target;
clearTimeout(targetElement.holdTimer);
});

// Abbrechen, wenn die Maus das Element verlässt
linecontainer.addEventListener('mouseleave', function(event) {
const targetElement = event.target;
clearTimeout(targetElement.holdTimer);
});

// Einfacher Klick-Event
linecontainer.addEventListener('click', function(event) {
const targetElement = event.target;
performLongPressAction(targetElement);
targetElementv = targetElement;
});

// Keydown für fokussierte Zeile
linecontainer.addEventListener('keydown', function() {
const focusedline = document.querySelector('.code-editor-line:focus');
if (!focusedline) {
return;
}
const targetElement = focusedline;
performLongPressAction(targetElement);
targetElementv = targetElement;
});

// Scroll-Event, um die Aktion für das zuletzt ausgewählte Element zu aktualisieren
linecontainer.addEventListener('scroll', function() {
if (targetElementv) {
performLongPressAction(targetElementv);
}
});


      linecontainer.addEventListener('touchstart', function(event) {
const targetElement = event.target;
        targetElementv = targetElement;
targetElement.holdTimer = setTimeout(() => {
performLongPressAction(targetElement);
          document.querySelector('.lineoptions').style.display = 'block';
}, 700);
});
      linecontainer.addEventListener('touchend', function(event) {
// Das berührte Element (event.target) erfassen
const targetElement = event.target;

        targetElementv = targetElement;
// Timer für das Ziel-Element abbrechen
clearTimeout(targetElement.holdTimer);
});
      linecontainer.addEventListener('click', function(event) {
        const targetElement = event.target;
        performLongPressAction(targetElement);
        targetElementv = targetElement;
      });
      linecontainer.addEventListener('keydown', function() {
const focusedline = document.querySelector('.code-editor-line:focus');
        if (!focusedline){
          return;
        }
        const targetElement = focusedline;
        performLongPressAction(targetElement);
        targetElementv = targetElement;
});


      linecontainer.addEventListener('scroll', function() {
        if (targetElementv){
          performLongPressAction(targetElementv);
        }
      });

    }

function performLongPressAction(element) {
      positionElementAbove(document.querySelector('.lineoptions'), element);
}
    function closelineoptionscontainer() {
      document.querySelector('.lineoptions').style.display = 'none';
    }
    function swipethislineleft() {
        if (!section){
            return;
        }
        if (section.classList.contains('viewcontainer')){
          return;
        }
       if (!targetElementv){
         return;
       }
       if (targetElementv.classList.contains('selected')) {
                targetElementv.classList.remove('selected');  // Linie abwählen bei links Swipe
            if (!section.querySelector('.code-editor-line.selected')){
                section.querySelectorAll('.eslbtn').forEach(dline => {
                    dline.classList.add('disabled');
                });
            }
                updateSelectedClasses();
            } else if (!targetElementv.classList.contains('selected') && !targetElementv.classList.contains('hiddenlinesparent') && !targetElementv.classList.contains('superselected')) {
                //startLine.classList.add('hiddenlinesparent');
            analyzeAndHideElements(targetElementv);
                updateSelectedClasses();
            } else if (targetElementv.classList.contains('superselected')) {
                targetElementv.classList.remove('superselected');  // Linie abwählen bei links Swipe
                targetElementv.classList.add('selected');  // Linie auswählen
                targetElementv.querySelectorAll('.eslbtn.disabled').forEach(dline => {
                    dline.classList.remove('disabled');
                });
                updateSelectedClasses();
        }
    }
    function swipethislineright() {
        if (!section){
            return;
        }
        if (section.classList.contains('viewcontainer')){
          return;
        }
      if (!targetElementv){
         return;
      }
      if (!targetElementv.classList.contains('selected') && !targetElementv.classList.contains('hiddenlinesparent') && !targetElementv.classList.contains('superselected')) {
                targetElementv.classList.add('selected');  // Linie auswählen
            section.querySelectorAll('.eslbtn.disabled').forEach(dline => {
                dline.classList.remove('disabled');
            });
                updateSelectedClasses();
            } else if (targetElementv.classList.contains('hiddenlinesparent')) {
                targetElementv.classList.remove('hiddenlinesparent');
            showHiddenElements(targetElementv);
                updateSelectedClasses();
            }else if (targetElementv.classList.contains('selected')) {
            let anothersuperselectedline = false;
            let superselectedline = section.querySelector('.code-editor-line.superselected');
            if (superselectedline){
                anothersuperselectedline = true;
            }
            targetElementv.classList.remove('selected');
            targetElementv.classList.add('superselected');  // Linie auswählen
            if (!section.querySelector('.code-editor-line.selected')){
                section.querySelectorAll('.eslbtn').forEach(dline => {
                    dline.classList.add('disabled');
                });
            }
            if (anothersuperselectedline == true){
                superselect(superselectedline, targetElementv);
                superselectedline.classList.remove('superselected');
                targetElementv.classList.remove('superselected');
                superselectedline.classList.add('selected');
                targetElementv.classList.add('selected');
                section.querySelectorAll('.eslbtn.disabled').forEach(dline => {
                    dline.classList.remove('disabled');
                });

            }
            updateSelectedClasses();
        }
    }

    const initialviewcontainerzindex = document.querySelector('.viewcontainer').style.zIndex;
    const initialviewcontainertop = document.querySelector('.viewcontainer').style.top;
    const initialviewcontainerleft = document.querySelector('.viewcontainer').style.left;
    let initialviewcontainerdisplay = document.querySelector('.viewcontainer').style.display;
    function viewthisfile() {

      initialviewcontainerdisplay = document.querySelector('.viewcontainer').style.display;
      document.querySelector('.viewcontainer').style.animation = "none";
        document.querySelector('.viewcontainer').style.position = "fixed";
        document.querySelector('.viewcontainer').style.top = "0";
        document.querySelector('.viewcontainer').style.left = "0"; /*`${sectionindex * 100}vh`;*/
      document.querySelector('.viewcontainer').style.zIndex = "1111";
      document.querySelector('.viewcontainer').style.display = "flex";


        // Hier wird die Klasse mit einem Punkt korrekt referenziert
        let filepathtext = document.querySelector('.navdot' + sectionindex + ' input[type="text"]').value;

        // Setzt den Wert für die URL-Eingaben
        document.getElementById('computer-url-input').value = filepathtext;
        document.getElementById('mobile-url-input').value = filepathtext;

      document.querySelector('.closeviewthisfilebtn').style.display = "flex";
    }

    function closeviewthisfile() {
        document.querySelector('.viewcontainer').style.position = "relative";
        document.querySelector('.viewcontainer').style.top = initialviewcontainertop;
        document.querySelector('.viewcontainer').style.left = initialviewcontainerleft;
      document.querySelector('.viewcontainer').style.zIndex = initialviewcontainerzindex;
      document.querySelector('.viewcontainer').style.display = initialviewcontainerdisplay;

      document.querySelector('.closeviewthisfilebtn').style.display = "none";
    }







        function checkiffile(filename) {
            let fileContent = "";
            document.querySelectorAll('.filedot').forEach(fd => {
                let filePathInputva = fd.querySelector('.filePathInput');
                if (filePathInputva && filePathInputva.value == filename) {
                    let sectionv = document.getElementById(`section${fd.getAttribute('data-index')}`);
                    if (sectionv) {
                        let container = sectionv.querySelector('.code-editor-container');
                        if (container) {
                            container.querySelectorAll('.code-editor-line').forEach(line => {
                                fileContent += line.innerText + "\n";
                            });
                            /*fileContent = container.textContent; // Verwende textContent für konsistenteren Zugriff*/
                            return; // Beendet die Schleife
                        }
                    }
                }
            });
            return fileContent;
        }



        function replaceLinksAndScripts(values) {
            let htmlString = checkiffile(values);
            const fileCache = new Map();

            // Hilfsfunktion, um Datei-Inhalte zu cachen
            const getFileContent = (filename) => {
                if (!fileCache.has(filename)) {
                    fileCache.set(filename, checkiffile(filename));
                }
                return fileCache.get(filename);
            };

            // Ersetze <link> mit CSS-Inhalt
            htmlString = htmlString.replace(/<link\s+[^>]*rel=["']stylesheet["'][^>]*href=["']([^"']+)["'][^>]*>/g, (match, href) => {
                const fileContent = checkiffile(href);
                return fileContent ? `<style>\n${fileContent}\n</style>` : match;
            });

            // Ersetze <script> mit JavaScript-Inhalt
            htmlString = htmlString.replace(/<script\s+[^>]*src=["']([^"']+)["'][^>]*><\/script>/g, (match, src) => {
                const fileContent = checkiffile(src);
                return fileContent ? `<script>\n${fileContent}\n<\/script>` : match;
            });

            return htmlString;
        }


        function textCode(textcontainerid, iframeid) {
            const code = replaceLinksAndScripts(document.getElementById(textcontainerid).value);
            document.getElementById(iframeid).srcdoc = code;
        }


        const swipeContainer = document.querySelector('.swipe-container');
        let startXvvv;

        // Update iFrame function for both views
        function updateIframe(type) {
            const iframe = document.getElementById(`${type}-frame`);
            const url = document.getElementById(`${type}-url-input`).value;
            iframe.src = url;
        }

        // Add touch event for swiping
        swipeContainer.addEventListener('touchstart', (e) => {
            startXvvv = e.touches[0].clientX;
        });

        swipeContainer.addEventListener('touchend', (e) => {
            const endX = e.changedTouches[0].clientX;
            handleSwipe(startXvvv, endX);
        });

        // Add mouse event for dragging to switch views
        swipeContainer.addEventListener('mousedown', (e) => {
            startXvvv = e.clientX;
        });

        swipeContainer.addEventListener('mouseup', (e) => {
            const endX = e.clientX;
            handleSwipe(startXvvv, endX);
        });

        // Function to handle swipe action
        function handleSwipe(start, end) {
            const distance = start - end;
            const threshold = 100; // Minimum swipe distance to trigger a change

            if (distance > threshold) {
                swipeContainer.scrollBy({ left: window.innerWidth, behavior: 'smooth' });
            } else if (distance < -threshold) {
                swipeContainer.scrollBy({ left: -window.innerWidth, behavior: 'smooth' });
            }
        }
        let originalDisplayStatus = [];




        function searchcode(thiselementhasthevalue) {
            if (!section){
                return;
            }
            if (section.classList.contains('viewcontainer')){
              return;
            }
            closelineoptionscontainer(); 

            const codesearchresults = document.querySelector('.codesearchresults');

            positionElementBelow(codesearchresults, thiselementhasthevalue);

            const inputvalue = thiselementhasthevalue.value.trim().toLowerCase();

            codesearchresults.style.display = inputvalue ? "flex" : "none";  

            codesearchresults.innerHTML = "";  

            if (inputvalue) {
                const parentSection = thiselementhasthevalue.closest(".section");
                const sectionlinecontainer = parentSection.querySelector('.code-editor-container');

                sectionlinecontainer.querySelectorAll(".code-editor-line").forEach(lineelement => {
                    if (lineelement.textContent.toLowerCase().includes(inputvalue)) {

                        const newspan = document.createElement('span');
                        newspan.classList.add('result');  
                        newspan.innerText = lineelement.textContent;
                        codesearchresults.appendChild(newspan);  

                        /*lineelement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center',
                        });*/
                        function scrollthislineintoviewnow(){
                            lineelement.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center',
                            });
                            setTimeout(() => {
                                performLongPressAction(lineelement);
                            }, 500);
                        }

                        newspan.addEventListener('click', () => {
                            scrollthislineintoviewnow();
                        });
                    }
                });
            }
        }








function positionElementBelow(elementToPosition, referenceElement) {
const referenceRect = referenceElement.getBoundingClientRect();
elementToPosition.style.position = 'absolute';
elementToPosition.style.top = `${referenceRect.bottom + window.innerHeight * 0.03}px`; // 3vh
elementToPosition.style.left = `${referenceRect.left}px`;
elementToPosition.style.display = "block"; // Sicherstellen, dass das Element sichtbar ist
}

    function updatelinenumbercheckbox(checkbox){
        if (!section){
            return;
        }
        if (section.classList.contains('viewcontainer')){
          return;
        }
      const dataValue = checkbox.getAttribute('data-update-id');
      if (dataValue){
        if (checkbox.checked == false){
          section.querySelector(`.code-editor-container`).id = dataValue + "off";
        }else if (checkbox.checked == true){
          section.querySelector(`.code-editor-container`).id = dataValue + "on";
        }
      }
    }

    function updatecheckboxed(checkbox){
        if (!section){
            return;
        }
        if (section.classList.contains('viewcontainer')){
          return;
        }
      const dataValue = checkbox.getAttribute('data-checked');
      if (dataValue){
        if (checkbox.checked == false){
          section.querySelectorAll(`#${dataValue}`).forEach(btn => {
              btn.style.display = "none";
            });
        }else if (checkbox.checked == true){
          section.querySelectorAll(`#${dataValue}`).forEach(btn => {
              btn.style.display = "inline-block";
            });
        }
      }
    }

    function checkboxupdatefunction() {
        if (!section){
            return;
        }
          if (section.classList.contains('viewcontainer')){
            return;
          }
          document.querySelectorAll('.switchbox').forEach(checkbox0 => {
              const dataValue = checkbox0.getAttribute('data-checked');

            section.querySelectorAll(`#${dataValue}`).forEach(btn0 => {
                  const displayStyle = btn0.style.display; // Holen des tatsächlichen Display-Werts

                if (displayStyle == "none") {
                    checkbox0.checked = false;
                } else {
                    checkbox0.checked = true; // Sobald das Element angezeigt wird, setzen wir die Checkbox auf true
                }
            });
        if (section.querySelector('.code-editor-container')){
          if (!dataValue && section.querySelector('.code-editor-container').id == "linenumberingoff"){
            checkbox0.checked = false;
          }else if (!dataValue && section.querySelector('.code-editor-container').id == "linenumberingon"){
            checkbox0.checked = true;
          }
        }
        });
    }



        navBar.addEventListener('mousedown', (e) => {
            isDragging = true;
            startY = e.clientY;
        });

        navBar.addEventListener('touchstart', (e) => {
            isDragging = true;
            startY = e.touches[0].clientY;
        });

        window.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const deltaY = startY - e.clientY;
                let newHeight = currentHeight + deltaY;

        if (section.classList.contains('viewcontainer')){
          return;
        }
                if (newHeight > 100) newHeight = 100;
                if (newHeight < 50) newHeight = 50;

                navBar.style.height = `${newHeight}vh`;
            }
        });

        window.addEventListener('touchmove', (e) => {
            if (isDragging) {
                const deltaY = startY - e.touches[0].clientY;
                let newHeight = currentHeight + deltaY;

        if (section.classList.contains('viewcontainer')){
          return;
        }
                if (newHeight > 100) newHeight = 100;
                if (newHeight < 50) newHeight = 50;

                navBar.style.height = `${newHeight}vh`;
            }
        });

    const seccontainer = document.querySelector('.seccontainer');
        window.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                if (parseInt(navBar.style.height) > 75 && !section.classList.contains('viewcontainer')) {
                    navBar.style.height = '100vh';
                    navBar.classList.add('expanded');
          seccontainer.style.display = 'flex';
                } else {
                    navBar.style.height = '50px';
                    navBar.classList.remove('expanded');
          seccontainer.style.display = 'none';
                }
            }
        });

        window.addEventListener('touchend', () => {
            if (isDragging) {
                isDragging = false;
                if (section && parseInt(navBar.style.height) > 75 && !section.classList.contains('viewcontainer')) {
                    navBar.style.height = '100vh';
                    navBar.classList.add('expanded');
          seccontainer.style.display = 'flex';
                } else {
                    navBar.style.height = '50px';
                    navBar.classList.remove('expanded');
          seccontainer.style.display = 'none';
                }
            }
        });

    const container = document.getElementById('container');
        let navDots = document.querySelectorAll('.nav-dot');
        let currentIndex = 0;

        // Function to scroll to specific section horizontally
      let previoussectionfsts = section;
        function scrollToSection(index) {
            if (section){
                if (section.classList.contains('viewcontainer')){
                    if (navBar.classList.contains('expanded')) {
                        navBar.style.height = '50px';
                        navBar.classList.remove('expanded');
                        seccontainer.style.display = 'none';
                    }
                }
            }

      const codesearchresults = document.querySelector('.codesearchresults');
codesearchresults.style.display = "none";
      closelineoptionscontainer();
            const sectionWidth = window.innerWidth;
          document.querySelectorAll('.section').forEach(sec => {
            if (sec.id != `section${index}`){
                  sec.style.animation = "none";
                        void sec.offsetWidth; // Trigger reflow
                        sec.style.animation = "swipeout 0.5s ease-out";
                        setTimeout(() => {
                            sec.style.display = 'none';
                         }, 400);
            }
          });
          setTimeout(() => {
            document.querySelector(`#section${index}`).style.display = 'flex';
            document.querySelector(`#section${index}`).style.animation = "none";
                void document.querySelector(`#section${index}`).offsetWidth; // Trigger reflow
                document.querySelector(`#section${index}`).style.animation = "swipein 0.5s ease-out";
          }, 400);
            //container.style.transform = `translateX(-${sectionWidth * index}px)`;
        }
        // Highlight active dot
        function highlightDot(index) {
            navDots.forEach(dot => {
                dot.classList.remove('active');
            });
            navDots[index].classList.add('active');
        }

        // Listen for scroll events on the navigation bar
    function scrolleivs() {
           if (!section){
               return;
           }
            navDots = document.querySelectorAll('.nav-dot');
      const sectionWidth = window.innerWidth;
            const scrollPos = navBar.scrollLeft;
            const index = Math.round(scrollPos / sectionWidth);
            if (index !== currentIndex) {
                    previoussectionfsts = section;
                    sectionindex = index;

        section = document.getElementById(`section${index}`);
                if (!section.classList.contains('viewcontainer')){
                    inputDiv = section.querySelector('.code-editor-container');
                    checkboxupdatefunction();
                }
                scrollToSection(index);
                highlightDot(index);
                currentIndex = index;
                updateviewthisfilebtn();
            }
    }
        navBar.addEventListener('scroll', () => {
      scrolleivs();
    });

    function navBarremoveeventlistenerscrollandadditagain() {
      navBar.removeEventListener('scroll', () => {
          scrolleivs();
        });
      navBar.addEventListener('scroll', () => {
          scrolleivs();
        });
    }

    function updateDataIndex(divId) {
           // Hole das div-Element mit der übergebenen ID
           const container = document.getElementById(divId);
           // Hole alle direkten Kind-Elemente des div
           const elements = container.children;
           // Iteriere durch die Elemente und setze den data-index-Wert
           for (let i = 0; i < elements.length; i++) {
                 elements[i].setAttribute('data-index', i);
           }
        }
    function updateClass(divclass) {
           // Hole das div-Element mit der übergebenen ID
           const container = document.querySelector("." + divId);
           // Hole alle direkten Kind-Elemente des div
           const elements = container.children;
           // Iteriere durch die Elemente und setze den data-index-Wert
           for (let i = 0; i < elements.length; i++) {
                 elements[i].id = `section${i}`;
           }
        }
        // Event listeners for navigation dots
        function dotonclick() {
            if (!section){
                return;
            }
            const sectionWidth = window.innerWidth;
            const scrollPos = navBar.scrollLeft;
            const index = Math.round(scrollPos / sectionWidth);
            if (section.id == document.getElementById(`section${index}`).id){
                return;
            }
            //const index = parseInt(dot.getAttribute('data-index'));
            scrollToSection(index);
            highlightDot(index);
            navBar.scrollLeft = index * window.innerWidth; // Scroll the bar
        section = document.getElementById(`section${index}`);
            if (!section.classList.contains('viewcontainer')){
                inputDiv = section.querySelector('.code-editor-container');
            }
      checkboxupdatefunction();
            currentIndex = index;
        }

        // Initialize first dot as active
        highlightDot(0);
    let correntids = 2;


      function checkifselectedlines() {
          if (!section){
              return;
          }
          const check = section.querySelector(".code-editor-line.selected");
          if (!check) {
            section.querySelectorAll('.eslbtn').forEach(dline => {
                dline.classList.add('disabled');
            });
          }
      }
      function deleteSelectedLines() {
            const allselectedlines = section.querySelectorAll(".code-editor-line.selected");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                if (selectedline.previousElementSibling || selectedline.nextElementSibling){
                  selectedline.remove();
                }else {
                  selectedline.innerHTML = "";
                }
                selectedline.classList.remove('selected');
                checkifselectedlines();
                });
            }
        }

      function deleteAllLines() {
            const allselectedlines = section.querySelectorAll(".code-editor-line");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                if (selectedline.previousElementSibling || selectedline.nextElementSibling){
                  selectedline.remove();
                }else {
                  selectedline.innerHTML = "";
                }
                checkifselectedlines();
                });
            }
        }

        function importantselectedlines() {
            const allselectedlines = section.querySelectorAll(".code-editor-line.selected");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                    selectedline.classList.toggle("importantpin");
                selectedline.classList.remove('selected');
                checkifselectedlines();
                });
            }
        }

      function unselectalllines() {
          const allselectedlines = section.querySelectorAll(".code-editor-line.selected");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                    selectedline.classList.remove('selected');  // Linie abwählen bei links Swipe
                if (!section.querySelector('.code-editor-line.selected')){
                    section.querySelectorAll('.eslbtn').forEach(dline => {
                        dline.classList.add('disabled');
                    });
                }
                    updateSelectedClasses();
                });
            }
      }

      function unfoldalllines() {
          const allselectedlines = section.querySelectorAll(".hiddenlinesparent");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                    selectedline.classList.remove('hiddenlinesparent');  // Linie auswählen
                showHiddenElements(selectedline);
                    updateSelectedClasses();
                });
            }
      }

      function importantalllines() {
            const allselectedlines = section.querySelectorAll(".importantpin");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                    selectedline.classList.remove("importantpin");
                checkifselectedlines();
                });
            }
        }

        function moveselectedlineup() {
            const allselectedlines = section.querySelectorAll(".code-editor-line.selected");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                    const previousLine = selectedline.previousElementSibling;
                    if (previousLine) {
                        selectedline.parentNode.insertBefore(selectedline, previousLine);
                    }
                });
            }
        }

        function moveselectedlinedown() {
            //const allselectedlines = document.querySelectorAll(".code-editor-line.selected");
          let allselectedlines = [...section.querySelectorAll('.code-editor-line.selected')];
            allselectedlines.reverse();
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                    const nextLine = selectedline.nextElementSibling;
                    if (nextLine) {
                        selectedline.parentNode.insertBefore(nextLine, selectedline);
                    }
                });
            }
        }

        function restselectedline() {
            const allselectedlines = section.querySelectorAll(".code-editor-line.selected");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                selectedline.classList.toggle("disableline");
                selectedline.classList.remove('selected');
                checkifselectedlines();
                }); // Korrekte Klammerung hier
            }
        }

      function unsleepalllines() {
            const allselectedlines = section.querySelectorAll(".disableline");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                allselectedlines.forEach(selectedline => {
                selectedline.classList.remove('disableline');
                });
            }
        }

      function changedeletebtn(deletebtnnnn) {
          const initialsign = deletebtnnnn.textContent;
      deletebtnnnn.style.animation = "none";
            void deletebtnnnn.offsetWidth; // Trigger reflow
            deletebtnnnn.style.animation = "rotatesign 0.5s ease-out";
      deletebtnnnn.disabled = true;
      setTimeout(() => {
          deletebtnnnn.textContent = '☑';
        }, 250);
        setTimeout(() => {
        deletebtnnnn.style.animation = "none";
                void deletebtnnnn.offsetWidth; // Trigger reflow
                deletebtnnnn.style.animation = "rotatesign 0.5s ease-out";
        setTimeout(() => {
          deletebtnnnn.textContent = initialsign;
          deletebtnnnn.disabled = false;
        }, 250);
      }, 1000);
      };

        function copyselectedlinetexts() {
            const allselectedlines = section.querySelectorAll(".code-editor-line.selected");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                let linetexts = "";
                allselectedlines.forEach(selectedline => {
                    linetexts += selectedline.textContent + "\n"; // Füge Zeilenumbruch hinzu
                }); // Korrekte Klammerung hier

            try {
                const newtextarea = document.createElement('textarea');
                    newtextarea.value = linetexts;
                    document.body.appendChild(newtextarea);
                    newtextarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(newtextarea);
                } catch (error) {
                    const thiserrorwascatched = error;
                }

                allselectedlines.forEach(selectedline => {
                    selectedline.classList.remove('selected');
                });

            checkifselectedlines();
                // Verwende die Clipboard API
                //navigator.clipboard.writeText(linetexts)
                //    .then(() => {
                //        console.log('Text copied to clipboard');
                //    })
                //    .catch(err => {
                //        console.error('Error copying text: ', err);
                //    });
            }
        }
      function copyalllinetexts() {
            const allselectedlines = section.querySelectorAll(".code-editor-line");
            if (allselectedlines.length) {  // Überprüfe, ob es ausgewählte Linien gibt
                let linetexts = "";
                allselectedlines.forEach(selectedline => {
                    linetexts += selectedline.textContent + "\n"; // Füge Zeilenumbruch hinzu
                }); // Korrekte Klammerung hier

            try {
                const newtextarea = document.createElement('textarea');
                    newtextarea.value = linetexts;
                    document.body.appendChild(newtextarea);
                    newtextarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(newtextarea);
                } catch (error) {
                    const thiserrorwascatched = error;
                }

                allselectedlines.forEach(selectedline => {
                    selectedline.classList.remove('selected');
                });
            checkifselectedlines();
                // Verwende die Clipboard API
                //navigator.clipboard.writeText(linetexts)
                //    .then(() => {
                //        console.log('Text copied to clipboard');
                //    })
                //    .catch(err => {
                //        console.error('Error copying text: ', err);
                //    });
            }
        }


        let startX, startLine;

        // Allgemeiner Event Listener für Touch-Events
        document.addEventListener('touchstart', function(event) {
            // Überprüfen, ob das Element eine Linie ist
            let target = event.target.closest('.code-editor-line');
            if (target) {
                startX = event.touches[0].clientX;  // Startkoordinate speichern
                startLine = target;  // Die Zeile speichern, auf der der Touch gestartet wurde
            }
        });

      let result = {};
        document.addEventListener('touchend', function(event) {
            if (!startLine) return;  // Keine Linie gestartet, nichts tun

            let endX = event.changedTouches[0].clientX;  // Endkoordinate speichern
            let diffX = endX - startX;  // Unterschied zwischen Start und Ende berechnen

            // Wenn nach rechts geswiped wird und auf derselben Zeile geendet wird
            if (diffX > 50 && !startLine.classList.contains('selected') && !startLine.classList.contains('hiddenlinesparent') && !startLine.classList.contains('superselected')) {
                startLine.classList.add('selected');  // Linie auswählen
            section.querySelectorAll('.eslbtn.disabled').forEach(dline => {
                dline.classList.remove('disabled');
            });
                updateSelectedClasses();
            } else if (diffX > 50 && startLine.classList.contains('hiddenlinesparent')) {
                startLine.classList.remove('hiddenlinesparent');  // Linie auswählen
            showHiddenElements(startLine);
                updateSelectedClasses();
            } else if (diffX > 50 && startLine.classList.contains('selected')) {
                let anothersuperselectedline = false;
                let superselectedline = section.querySelector('.code-editor-line.superselected');
                if (superselectedline){
                    anothersuperselectedline = true;
                }
                startLine.classList.remove('selected');
                startLine.classList.add('superselected');  // Linie auswählen
                if (!section.querySelector('.code-editor-line.selected')){
                    section.querySelectorAll('.eslbtn').forEach(dline => {
                        dline.classList.add('disabled');
                    });
                }
                if (anothersuperselectedline == true){
                    superselect(superselectedline, startLine);
                    superselectedline.classList.remove('superselected');
                    startLine.classList.remove('superselected');
                    superselectedline.classList.add('selected');
                    startLine.classList.add('selected');
                    section.querySelectorAll('.eslbtn.disabled').forEach(dline => {
                        dline.classList.remove('disabled');
                    });

                }
                updateSelectedClasses();
            } else if (diffX < -50 && startLine.classList.contains('selected')) {
                startLine.classList.remove('selected');  // Linie abwählen bei links Swipe
            if (!section.querySelector('.code-editor-line.selected')){
                section.querySelectorAll('.eslbtn').forEach(dline => {
                    dline.classList.add('disabled');
                });
            }
                updateSelectedClasses();
            } else if (diffX < -50 && startLine.classList.contains('superselected')) {
                startLine.classList.remove('superselected');  // Linie abwählen bei links Swipe
                startLine.classList.add('selected');  // Linie auswählen
                section.querySelectorAll('.eslbtn.disabled').forEach(dline => {
                    dline.classList.remove('disabled');
                });
                updateSelectedClasses();
            } else if (diffX < -50 && !startLine.classList.contains('selected') && !startLine.classList.contains('hiddenlinesparent')) {
                //startLine.classList.add('hiddenlinesparent');
            analyzeAndHideElements(startLine);
                updateSelectedClasses();
            } 

            startLine = null;  // Touch-Zustand zurücksetzen
        });

        //let inputDiv = section.querySelector('.code-editor-container');

        function superselect(superselectedline, superselectedline2) {
            // select every line inbetween superselectedline and superselectedline2
            let allselectedlines = Array.from(section.querySelectorAll('.code-editor-line'));
            let startindex = allselectedlines.indexOf(superselectedline);
            let endindex = allselectedlines.indexOf(superselectedline2);

            if (superselectedline.classList.contains('hidden') || superselectedline2.classList.contains('hidden')){
                return;
            }

            // select the lines inbetween startindex and endindex
            if (startindex < endindex) {
                for (let i = startindex + 1; i < endindex; i++) {
                    if (allselectedlines[i].classList.contains('hiddenlinesparent')) {
                        allselectedlines[i].classList.remove('hiddenlinesparent');  // Linie auswählen
                        showHiddenElements(allselectedlines[i]);
                        updateSelectedClasses();
                    }
                    if (!allselectedlines[i].classList.contains('selected')){
                        allselectedlines[i].classList.add('selected');
                    }
                }
            } else if (startindex > endindex) {
                for (let i = startindex - 1; i > endindex; i--) {
                    if (allselectedlines[i].classList.contains('hiddenlinesparent')) {
                        allselectedlines[i].classList.remove('hiddenlinesparent');  // Linie auswählen
                        showHiddenElements(allselectedlines[i]);
                        updateSelectedClasses();
                    }
                    if (!allselectedlines[i].classList.contains('selected')){
                        allselectedlines[i].classList.add('selected');
                    }
                }
            }
            updateSelectedClasses();
        }

        // Paste Event-Listener
        function handlePaste(event) {
            event.preventDefault(); // Verhindert das Standardverhalten des Einfügens

            let celine = section.querySelector('.code-editor-line:focus');
            if (!celine) return; // Sicherstellen, dass celine existiert

            // Ermitteln der führenden Leerzeichen in der aktuellen Linie
            let spaces = "";
            let continueSpaces = true;
            for (let i = 0; i < celine.textContent.length; i++) {
                let character = celine.textContent[i];
                if ((character === " " || character === "\u00A0") && continueSpaces) {
                    spaces += "\u00A0"; // Unicode für nicht-trennbares Leerzeichen
                } else {
                    continueSpaces = false;
                }
            }

            // Kopierten Text aus der Zwischenablage holen
            let pasteText = (event.clipboardData || window.clipboardData).getData('text');

            // Aufteilen des eingefügten Textes bei Zeilenumbrüchen
            let lines = pasteText.split(/\r\n|\n|\r/);

            let selection = window.getSelection();
            if (selection.rangeCount === 0) return; // Überprüfen, ob ein Range existiert

            let range = selection.getRangeAt(0);
            let cursorOffset = range.startOffset;

            // Text vor dem Cursor behalten und Text nach dem Cursor extrahieren
            let currentText = celine.textContent;
            let textAfterCursor = currentText.substring(cursorOffset);
            celine.textContent = currentText.substring(0, cursorOffset);

            // Verarbeite die erste Linie: Der Text wird in die aktuelle Linie eingefügt
            celine.textContent += convertToNonBreakingSpaces(lines[0]);

            // Für die folgenden Zeilen, füge sie als neue Linien (divs) hinzu
            for (let i = 1; i < lines.length; i++) {
                correntids += 1;
                const newline = document.createElement('div');
                newline.setAttribute('contenteditable', 'true');
                newline.id = correntids;
                newline.classList.add('code-editor-line');
                newline.textContent = spaces + convertToNonBreakingSpaces(lines[i]);
                celine.insertAdjacentElement('afterend', newline);
                celine = newline;
            }

            // Text nach dem Cursor in die letzte Linie einfügen
            celine.textContent += convertToNonBreakingSpaces(textAfterCursor);

            // Setze den Cursor ans Ende der letzten Linie
            const newRange = document.createRange();

            // Sicherstellen, dass der neue Range korrekt auf das letzte Kind des celine-Elements gesetzt wird
            let lastChild = celine.lastChild;
            if (lastChild) {
                newRange.setStart(lastChild, lastChild.length); // Cursor ans Ende des letzten Kindes setzen
            } else {
                // Falls kein Textknoten vorhanden ist, einfach auf das Ende des Elements setzen
                newRange.setStart(celine, celine.textContent.length);
            }

            newRange.collapse(true);
            selection.removeAllRanges();
            selection.addRange(newRange);
        }




      function analyzeAndHideElements(element) {
          function countLeadingSpaces(text) {
              //return text.match(/^ * /)[0].length;
            let spaces = 0;
              let continueSpaces = true;
              for (let i = 0; i < text.length; i++) {
                  let character = text[i];
                  if ((character === " " || character === "\u00A0") && continueSpaces) {
                      spaces += 1;
                  } else {
                      continueSpaces = false;
                  }
              }
            return spaces;
          }

          // Das empfangene Element und seine führenden Leerzeichen ermitteln
          const referenceSpaces = countLeadingSpaces(element.textContent);
          const hiddenElements = [];

          // Nächstes Element in der DOM-Hierarchie bekommen
          let nextElement = element.nextElementSibling;

        if (nextElement){
            element.classList.add('hiddenlinesparent');
        }else {
            return;
        }
          // Schleife durch alle nachfolgenden Geschwister-Elemente
          while (nextElement) {
              const nextText = nextElement.textContent;
              const nextSpaces = countLeadingSpaces(nextText);

              // Überprüfen, ob das nächste Element mehr führende Leerzeichen hat
              if (nextSpaces > referenceSpaces || nextText.trim() == "") {
                  // Element in die Liste der versteckten Elemente aufnehmen
                  hiddenElements.push(nextElement);
                  nextElement.classList.add('hidden');  // Element verstecken
              } else {
                  break;  // Schleife beenden, wenn weniger oder gleich viele Leerzeichen
              }

              // Zum nächsten Geschwister-Element wechseln
              nextElement = nextElement.nextElementSibling;
          }

          // JSON-Struktur erstellen
          result[element.id] = hiddenElements;
        }

      function showHiddenElements(element) {
            if (result[element.id]) {
                const hiddenElements = result[element.id].reverse();
                hiddenElements.forEach(hiddenElement => {
                if (hiddenElement){
                  hiddenElement.classList.remove('hidden');
                  if (hiddenElement.classList.contains('hiddenlinesparent')){
                      hiddenElement.classList.remove('hiddenlinesparent');
                      showHiddenElements(hiddenElement);
                      analyzeAndHideElements(hiddenElement);
                  }
                }
                });
                delete result[element.id];
            }
        }



        // Hilfsfunktion, um Leerzeichen in &nbsp; zu konvertieren
        function convertToNonBreakingSpaces(text) {
            return text.replace(/ /g, ' ').replace(/\t/g, '    '); // Konvertiert Leerzeichen und Tabs in nicht-brechende Leerzeichen
        }

        // Enter- und Backspace-Event-Listener
        function handleKeyDown(event) {
            let celine = section.querySelector('.code-editor-line:focus');

            if (event.key === 'Enter') {
                event.preventDefault(); // Verhindert das Standardverhalten der Enter-Taste

                if (celine) {
                    correntids += 1;
                    const newid = correntids;

                    // Teile den Text basierend auf der Cursorposition
                    const text = celine.textContent;
                    const selection = window.getSelection();
                    const range = selection.getRangeAt(0);
                    const cursorOffset = range.startOffset;

                    const textBehindCursor = text.substring(cursorOffset);
                    celine.textContent = text.substring(0, cursorOffset);

                    // Berechne führende Leerzeichen oder Tabs
                    let spaces = "";
                    for (let i = 0; i < celine.textContent.length; i++) {
                        const character = celine.textContent[i];
                        if (character === " " || character === "\u00A0") {
                            spaces += "\u00A0"; // Unicode für ein nicht-trennbares Leerzeichen
                        } else {
                            break;
                        }
                    }

                    // Neue Zeile erstellen
                    const newline = document.createElement('div');
                    newline.setAttribute('contenteditable', 'true');
                    newline.id = newid;
                    newline.classList.add('code-editor-line');
                    newline.textContent = spaces + textBehindCursor;

                    // Neue Zeile einfügen
                    celine.insertAdjacentElement('afterend', newline);

                    // Fokus und Cursor in die neue Zeile setzen
                    newline.focus();
                    const newRange = document.createRange();
                    newRange.setStart(newline.firstChild || newline, spaces.length);
                    newRange.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(newRange);

                    updateSelectedClasses();
                }
            }


            if (event.key === 'Backspace') {
                let selection = window.getSelection();
                let range = selection.getRangeAt(0);

                if (range.startOffset === 0 && celine) {
                    event.preventDefault();

                    const previousLine = celine.previousElementSibling;
                    if (previousLine) {
                        updateSelectedClasses();

                        // Hole den aktuellen Text der aktuellen Zeile und der vorherigen Zeile
                        const currentLineText = celine.textContent;
                        const previousLineText = previousLine.textContent;

                        // Entferne die aktuelle Zeile
                        celine.remove();

                        // Füge den Text der aktuellen Zeile zur vorherigen Zeile hinzu
                        previousLine.textContent = previousLineText + currentLineText;

                        // Setze den Fokus auf die vorherige Zeile und positioniere den Cursor ans Ende
                        const newRange = document.createRange();
                        const textLength = previousLine.textContent.length;

                        newRange.setStart(previousLine.firstChild || previousLine, textLength);
                        newRange.collapse(true);

                        selection.removeAllRanges();
                        selection.addRange(newRange);
                    }
                }
            }


            // Backspace-Taste
            /*if (event.key === 'Backspace') {
                let selection = window.getSelection();
                let range = selection.getRangeAt(0);

                if (range.startOffset === 0 && celine) {
                    event.preventDefault();

                    const previousLine = celine.previousElementSibling;
                    if (previousLine) {
                  updateSelectedClasses();
                        let currentLineText = celine.textContent;

                        celine.remove();
                        previousLine.textContent += currentLineText;

                        previousLine.focus();
                        range = document.createRange();
                        range.setStart(previousLine.childNodes[0], previousLine.childNodes[0].length - currentLineText.length);
                        range.collapse(true);
                        selection.removeAllRanges();
                        selection.addRange(range);
                    }
                }
            }*/

          if (event.key === '>') {
             let selection = window.getSelection();
             let range = selection.getRangeAt(0);
             let cursorOffset = range.startOffset;

             // Holen des aktuellen Texts vor dem Cursor
             let text = celine.textContent.substring(0, cursorOffset);
             // Prüfen, ob der Text einen öffnenden Tag enthält
             let openTagMatch = text.match(/<(\w+)([^>]*)$/);

             if (openTagMatch) {
                 event.preventDefault(); // Verhindert das Standardverhalten

                 // Tag automatisch schließen
                 let tagName = openTagMatch[1];
                 let tagEnd = `</${tagName}>`;
                 // Fügen Sie den schließenden Tag direkt nach dem Cursor ein
                 let textAfterCursor = celine.textContent.substring(cursorOffset);
                 celine.textContent = text + '>' + tagEnd + textAfterCursor;

                 // Setzen Sie den Cursor zwischen die Tags
                 range.setStart(celine.firstChild, cursorOffset + 1);
                 range.collapse(true);
                 selection.removeAllRanges();
                 selection.addRange(range);
             }
          }

          let selection = window.getSelection();

          let range = selection.getRangeAt(0);
          let cursorOffset = range.startOffset;

            // Erstellen einer Funktion, die das aktuelle Zeichen schließt
            function insertClosingCharacter(openingChar, closingChar) {
                let text = celine.textContent;
                let textAfterCursor = text.substring(cursorOffset);
                celine.textContent = text.substring(0, cursorOffset) + openingChar + closingChar + textAfterCursor;

                // Cursor zwischen den Zeichen platzieren
                range.setStart(celine.firstChild, cursorOffset + 1);
                range.collapse(true);
                selection.removeAllRanges();
                selection.addRange(range);
            }

            // Automatisches Schließen von '{'
            if (event.key === '{') {
                event.preventDefault();
                insertClosingCharacter('{', '}');
            }

          if (event.key === '[') {
                event.preventDefault();
                insertClosingCharacter('[', ']');
            }

            // Automatisches Schließen von '('
            if (event.key === '(') {
                event.preventDefault();
                insertClosingCharacter('(', ')');
            }

            // Automatisches Schließen von '`'
            if (event.key === '`') {
                event.preventDefault();
                insertClosingCharacter('`', '`');
            }

            // Automatisches Schließen von '„'
            if (event.key === '„') {
                event.preventDefault();
                insertClosingCharacter('"', '"');
            }

            // Automatisches Schließen von '‚'
            if (event.key === '‚') {
                event.preventDefault();
                insertClosingCharacter('\'', '\'');
            }

          if (event.key === '"') {
                event.preventDefault();
                insertClosingCharacter('"', '"');
            }

            // Automatisches Schließen von '‚'
            if (event.key === "'") {
                event.preventDefault();
                insertClosingCharacter('\'', '\'');
            }

          function checkAndSkipClosingCharacter(closingChar) {
              let text = celine.textContent;
            let nextChar = text.charAt(cursorOffset);
            if (nextChar === closingChar) {
                event.preventDefault();
                range.setStart(celine.firstChild, cursorOffset + 1);
                range.collapse(true);
                selection.removeAllRanges();
                selection.addRange(range);
              }
          }

          if (event.key === ']') {
              checkAndSkipClosingCharacter(']');
          }
          if (event.key === '}') {
            checkAndSkipClosingCharacter('}');
          }
          if (event.key === '"') {
              checkAndSkipClosingCharacter('"');
          }
          if (event.key === "'") {
            checkAndSkipClosingCharacter("'");
          }
          if (event.key === ')') {
            checkAndSkipClosingCharacter(')');
          }
          if (event.key === ';') {
            checkAndSkipClosingCharacter(';');
          }
      }
        function updateSelectedClasses() {
            const lines = section.querySelectorAll('.code-editor-line');

            lines.forEach((line, index) => {
                const isSelected = line.classList.contains('selected');

                // Überprüfen, ob es über und unter der Zeile selektierte Zeilen gibt
                const hasAbove = index > 0 && lines[index - 1].classList.contains('selected');
                const hasBelow = index < lines.length - 1 && lines[index + 1].classList.contains('selected');

                // Entfernen aller relevanten Klassen
            if (line.classList.contains('topSelected')){
                line.classList.remove('topSelected');
            }
            if (line.classList.contains('bottomSelected')){
                line.classList.remove('bottomSelected');
            }
            if (line.classList.contains('middleSelected')){
                line.classList.remove('middleSelected');
            }
            if (line.classList.contains('singleSelected')){
                line.classList.remove('singleSelected');
            }

                if (isSelected) {
                    if (!hasAbove && !hasBelow) {
                        // Single selected
                        line.classList.add('singleSelected');
                    } else if (!hasAbove && hasBelow) {
                        // Top selected
                        line.classList.add('topSelected');
                    } else if (hasAbove && !hasBelow) {
                        // Bottom selected
                        line.classList.add('bottomSelected');
                    } else if (hasAbove && hasBelow) {
                        // Middle selected
                        line.classList.add('middleSelected');
                    }
                }
            });
        }

  </script>

</body>
</html>
